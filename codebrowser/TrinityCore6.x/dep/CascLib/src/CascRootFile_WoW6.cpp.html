<!doctype html>
<html>
<head>
<title>CascRootFile_WoW6.cpp [TrinityCore6.x/dep/CascLib/src/CascRootFile_WoW6.cpp] - Woboq Code Browser</title>
<link rel="stylesheet" href="../../../../../data/kdevelop.css" title="KDevelop"/>
<link rel="alternate stylesheet" href="../../../../../data/qtcreator.css" title="QtCreator"/>
<script type="text/javascript" src="../../../../../data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../../../data/jquery/jquery-ui.min.js"></script>
<script>var file = 'TrinityCore6.x/dep/CascLib/src/CascRootFile_WoW6.cpp'; var root_path = '../../../..'; var data_path = '../../../../../data';</script>
<script src='../../../../../data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Source code of </span><a href='../../..'>TrinityCore6.x</a>/<a href='../..'>dep</a>/<a href='..'>CascLib</a>/<a href='./'>src</a>/CascRootFile_WoW6.cpp</h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*****************************************************************************/</i></td></tr>
<tr><th id="2">2</th><td><i>/* CascOpenStorage.cpp                    Copyright (c) Ladislav Zezula 2014 */</i></td></tr>
<tr><th id="3">3</th><td><i>/*---------------------------------------------------------------------------*/</i></td></tr>
<tr><th id="4">4</th><td><i>/* Storage functions for CASC                                                */</i></td></tr>
<tr><th id="5">5</th><td><i>/* Note: WoW6 offsets refer to WoW.exe 6.0.3.19116 (32-bit)                  */</i></td></tr>
<tr><th id="6">6</th><td><i>/* SHA1: c10e9ffb7d040a37a356b96042657e1a0c95c0dd                            */</i></td></tr>
<tr><th id="7">7</th><td><i>/*---------------------------------------------------------------------------*/</i></td></tr>
<tr><th id="8">8</th><td><i>/*   Date    Ver   Who  Comment                                              */</i></td></tr>
<tr><th id="9">9</th><td><i>/* --------  ----  ---  -------                                              */</i></td></tr>
<tr><th id="10">10</th><td><i>/* 29.04.14  1.00  Lad  The first version of CascOpenStorage.cpp             */</i></td></tr>
<tr><th id="11">11</th><td><i>/*****************************************************************************/</i></td></tr>
<tr><th id="12">12</th><td></td></tr>
<tr><th id="13">13</th><td><u>#define <dfn class="macro" id="_M/__CASCLIB_SELF__" data-ref="_M/__CASCLIB_SELF__">__CASCLIB_SELF__</dfn></u></td></tr>
<tr><th id="14">14</th><td><u>#include <a href="CascLib.h.html">"CascLib.h"</a></u></td></tr>
<tr><th id="15">15</th><td><u>#include <a href="CascCommon.h.html">"CascCommon.h"</a></u></td></tr>
<tr><th id="16">16</th><td></td></tr>
<tr><th id="17">17</th><td><i>//-----------------------------------------------------------------------------</i></td></tr>
<tr><th id="18">18</th><td><i>// Local structures</i></td></tr>
<tr><th id="19">19</th><td></td></tr>
<tr><th id="20">20</th><td><u>#define <dfn class="macro" id="_M/ROOT_SEARCH_PHASE_INITIALIZING" data-ref="_M/ROOT_SEARCH_PHASE_INITIALIZING">ROOT_SEARCH_PHASE_INITIALIZING</dfn>  0</u></td></tr>
<tr><th id="21">21</th><td><u>#define <dfn class="macro" id="_M/ROOT_SEARCH_PHASE_LISTFILE" data-ref="_M/ROOT_SEARCH_PHASE_LISTFILE">ROOT_SEARCH_PHASE_LISTFILE</dfn>      1</u></td></tr>
<tr><th id="22">22</th><td><u>#define <dfn class="macro" id="_M/ROOT_SEARCH_PHASE_NAMELESS" data-ref="_M/ROOT_SEARCH_PHASE_NAMELESS">ROOT_SEARCH_PHASE_NAMELESS</dfn>      2</u></td></tr>
<tr><th id="23">23</th><td><u>#define <dfn class="macro" id="_M/ROOT_SEARCH_PHASE_FINISHED" data-ref="_M/ROOT_SEARCH_PHASE_FINISHED">ROOT_SEARCH_PHASE_FINISHED</dfn>      2</u></td></tr>
<tr><th id="24">24</th><td></td></tr>
<tr><th id="25">25</th><td><i>// On-disk version of locale block</i></td></tr>
<tr><th id="26">26</th><td><b>typedef</b> <b>struct</b> <dfn class="type def" id="_FILE_LOCALE_BLOCK" title='_FILE_LOCALE_BLOCK' data-ref="_FILE_LOCALE_BLOCK" ><a class="type" href="#_FILE_LOCALE_BLOCK" title='_FILE_LOCALE_BLOCK' data-ref="_FILE_LOCALE_BLOCK" ><a class="type" href="#_FILE_LOCALE_BLOCK" title='_FILE_LOCALE_BLOCK' data-ref="_FILE_LOCALE_BLOCK" >_FILE_LOCALE_BLOCK</a></a></dfn></td></tr>
<tr><th id="27">27</th><td>{</td></tr>
<tr><th id="28">28</th><td>    <a class="typedef" href="CascPort.h.html#DWORD" title='DWORD' data-type='unsigned int' data-ref="DWORD" >DWORD</a> <dfn class="tu decl" id="_FILE_LOCALE_BLOCK::NumberOfFiles" title='_FILE_LOCALE_BLOCK::NumberOfFiles' data-type='DWORD' data-ref="_FILE_LOCALE_BLOCK::NumberOfFiles" >NumberOfFiles</dfn>;                        <i  data-doc="_FILE_LOCALE_BLOCK::NumberOfFiles">// Number of entries</i></td></tr>
<tr><th id="29">29</th><td>    <a class="typedef" href="CascPort.h.html#DWORD" title='DWORD' data-type='unsigned int' data-ref="DWORD" >DWORD</a> <dfn class="tu decl" id="_FILE_LOCALE_BLOCK::Flags" title='_FILE_LOCALE_BLOCK::Flags' data-type='DWORD' data-ref="_FILE_LOCALE_BLOCK::Flags" >Flags</dfn>;</td></tr>
<tr><th id="30">30</th><td>    <a class="typedef" href="CascPort.h.html#DWORD" title='DWORD' data-type='unsigned int' data-ref="DWORD" >DWORD</a> <dfn class="tu decl" id="_FILE_LOCALE_BLOCK::Locales" title='_FILE_LOCALE_BLOCK::Locales' data-type='DWORD' data-ref="_FILE_LOCALE_BLOCK::Locales" >Locales</dfn>;                              <i  data-doc="_FILE_LOCALE_BLOCK::Locales">// File locale mask (CASC_LOCALE_XXX)</i></td></tr>
<tr><th id="31">31</th><td></td></tr>
<tr><th id="32">32</th><td>    <i>// Followed by a block of 32-bit integers (count: NumberOfFiles)</i></td></tr>
<tr><th id="33">33</th><td><i>    // Followed by the MD5 and file name hash (count: NumberOfFiles)</i></td></tr>
<tr><th id="34">34</th><td></td></tr>
<tr><th id="35">35</th><td>} <dfn class="typedef" id="FILE_LOCALE_BLOCK" title='FILE_LOCALE_BLOCK' data-type='struct _FILE_LOCALE_BLOCK' data-ref="FILE_LOCALE_BLOCK" >FILE_LOCALE_BLOCK</dfn>, *<dfn class="typedef" id="PFILE_LOCALE_BLOCK" title='PFILE_LOCALE_BLOCK' data-type='struct _FILE_LOCALE_BLOCK *' data-ref="PFILE_LOCALE_BLOCK" >PFILE_LOCALE_BLOCK</dfn>;</td></tr>
<tr><th id="36">36</th><td></td></tr>
<tr><th id="37">37</th><td><i>// On-disk version of root entry</i></td></tr>
<tr><th id="38">38</th><td><b>typedef</b> <b>struct</b> <dfn class="type def" id="_FILE_ROOT_ENTRY" title='_FILE_ROOT_ENTRY' data-ref="_FILE_ROOT_ENTRY" ><a class="type" href="#_FILE_ROOT_ENTRY" title='_FILE_ROOT_ENTRY' data-ref="_FILE_ROOT_ENTRY" ><a class="type" href="#_FILE_ROOT_ENTRY" title='_FILE_ROOT_ENTRY' data-ref="_FILE_ROOT_ENTRY" >_FILE_ROOT_ENTRY</a></a></dfn></td></tr>
<tr><th id="39">39</th><td>{</td></tr>
<tr><th id="40">40</th><td>    <a class="typedef" href="CascCommon.h.html#ENCODING_KEY" title='ENCODING_KEY' data-type='struct _ENCODING_KEY' data-ref="ENCODING_KEY" >ENCODING_KEY</a> <dfn class="tu decl" id="_FILE_ROOT_ENTRY::EncodingKey" title='_FILE_ROOT_ENTRY::EncodingKey' data-type='ENCODING_KEY' data-ref="_FILE_ROOT_ENTRY::EncodingKey" >EncodingKey</dfn>;                   <i  data-doc="_FILE_ROOT_ENTRY::EncodingKey">// MD5 of the file</i></td></tr>
<tr><th id="41">41</th><td>    <a class="typedef" href="CascPort.h.html#ULONGLONG" title='ULONGLONG' data-type='unsigned long long' data-ref="ULONGLONG" >ULONGLONG</a> <dfn class="tu decl" id="_FILE_ROOT_ENTRY::FileNameHash" title='_FILE_ROOT_ENTRY::FileNameHash' data-type='ULONGLONG' data-ref="_FILE_ROOT_ENTRY::FileNameHash" >FileNameHash</dfn>;                     <i  data-doc="_FILE_ROOT_ENTRY::FileNameHash">// Jenkins hash of the file name</i></td></tr>
<tr><th id="42">42</th><td></td></tr>
<tr><th id="43">43</th><td>} <dfn class="typedef" id="FILE_ROOT_ENTRY" title='FILE_ROOT_ENTRY' data-type='struct _FILE_ROOT_ENTRY' data-ref="FILE_ROOT_ENTRY" >FILE_ROOT_ENTRY</dfn>, *<dfn class="typedef" id="PFILE_ROOT_ENTRY" title='PFILE_ROOT_ENTRY' data-type='struct _FILE_ROOT_ENTRY *' data-ref="PFILE_ROOT_ENTRY" >PFILE_ROOT_ENTRY</dfn>;</td></tr>
<tr><th id="44">44</th><td></td></tr>
<tr><th id="45">45</th><td></td></tr>
<tr><th id="46">46</th><td><b>typedef</b> <b>struct</b> <dfn class="type def" id="_CASC_ROOT_BLOCK" title='_CASC_ROOT_BLOCK' data-ref="_CASC_ROOT_BLOCK" ><a class="type" href="#_CASC_ROOT_BLOCK" title='_CASC_ROOT_BLOCK' data-ref="_CASC_ROOT_BLOCK" ><a class="type" href="#_CASC_ROOT_BLOCK" title='_CASC_ROOT_BLOCK' data-ref="_CASC_ROOT_BLOCK" >_CASC_ROOT_BLOCK</a></a></dfn></td></tr>
<tr><th id="47">47</th><td>{</td></tr>
<tr><th id="48">48</th><td>    <a class="typedef" href="#PFILE_LOCALE_BLOCK" title='PFILE_LOCALE_BLOCK' data-type='struct _FILE_LOCALE_BLOCK *' data-ref="PFILE_LOCALE_BLOCK" >PFILE_LOCALE_BLOCK</a> <dfn class="tu decl" id="_CASC_ROOT_BLOCK::pLocaleBlockHdr" title='_CASC_ROOT_BLOCK::pLocaleBlockHdr' data-type='PFILE_LOCALE_BLOCK' data-ref="_CASC_ROOT_BLOCK::pLocaleBlockHdr" >pLocaleBlockHdr</dfn>;         <i  data-doc="_CASC_ROOT_BLOCK::pLocaleBlockHdr">// Pointer to the locale block</i></td></tr>
<tr><th id="49">49</th><td>    <a class="typedef" href="CascPort.h.html#PDWORD" title='PDWORD' data-type='DWORD *' data-ref="PDWORD" >PDWORD</a> <dfn class="tu decl" id="_CASC_ROOT_BLOCK::FileDataIds" title='_CASC_ROOT_BLOCK::FileDataIds' data-type='PDWORD' data-ref="_CASC_ROOT_BLOCK::FileDataIds" >FileDataIds</dfn>;                         <i  data-doc="_CASC_ROOT_BLOCK::FileDataIds">// Pointer to the array of File Data IDs</i></td></tr>
<tr><th id="50">50</th><td>    <a class="typedef" href="#PFILE_ROOT_ENTRY" title='PFILE_ROOT_ENTRY' data-type='struct _FILE_ROOT_ENTRY *' data-ref="PFILE_ROOT_ENTRY" >PFILE_ROOT_ENTRY</a> <dfn class="tu decl" id="_CASC_ROOT_BLOCK::pRootEntries" title='_CASC_ROOT_BLOCK::pRootEntries' data-type='PFILE_ROOT_ENTRY' data-ref="_CASC_ROOT_BLOCK::pRootEntries" >pRootEntries</dfn>;</td></tr>
<tr><th id="51">51</th><td></td></tr>
<tr><th id="52">52</th><td>} <dfn class="typedef" id="CASC_ROOT_BLOCK" title='CASC_ROOT_BLOCK' data-type='struct _CASC_ROOT_BLOCK' data-ref="CASC_ROOT_BLOCK" >CASC_ROOT_BLOCK</dfn>, *<dfn class="typedef" id="PCASC_ROOT_BLOCK" title='PCASC_ROOT_BLOCK' data-type='struct _CASC_ROOT_BLOCK *' data-ref="PCASC_ROOT_BLOCK" >PCASC_ROOT_BLOCK</dfn>;</td></tr>
<tr><th id="53">53</th><td></td></tr>
<tr><th id="54">54</th><td><i>// Root file entry for CASC storages without MNDX root file (World of Warcraft 6.0+)</i></td></tr>
<tr><th id="55">55</th><td><i>// Does not match to the in-file structure of the root entry</i></td></tr>
<tr><th id="56">56</th><td><b>typedef</b> <b>struct</b> <dfn class="type def" id="_CASC_FILE_ENTRY" title='_CASC_FILE_ENTRY' data-ref="_CASC_FILE_ENTRY" ><a class="type" href="#_CASC_FILE_ENTRY" title='_CASC_FILE_ENTRY' data-ref="_CASC_FILE_ENTRY" ><a class="type" href="#_CASC_FILE_ENTRY" title='_CASC_FILE_ENTRY' data-ref="_CASC_FILE_ENTRY" >_CASC_FILE_ENTRY</a></a></dfn></td></tr>
<tr><th id="57">57</th><td>{</td></tr>
<tr><th id="58">58</th><td>    <a class="typedef" href="CascCommon.h.html#ENCODING_KEY" title='ENCODING_KEY' data-type='struct _ENCODING_KEY' data-ref="ENCODING_KEY" >ENCODING_KEY</a> <dfn class="tu decl" id="_CASC_FILE_ENTRY::EncodingKey" title='_CASC_FILE_ENTRY::EncodingKey' data-type='ENCODING_KEY' data-ref="_CASC_FILE_ENTRY::EncodingKey" >EncodingKey</dfn>;                       <i  data-doc="_CASC_FILE_ENTRY::EncodingKey">// File encoding key (MD5)</i></td></tr>
<tr><th id="59">59</th><td>    <a class="typedef" href="CascPort.h.html#ULONGLONG" title='ULONGLONG' data-type='unsigned long long' data-ref="ULONGLONG" >ULONGLONG</a> <dfn class="tu decl" id="_CASC_FILE_ENTRY::FileNameHash" title='_CASC_FILE_ENTRY::FileNameHash' data-type='ULONGLONG' data-ref="_CASC_FILE_ENTRY::FileNameHash" >FileNameHash</dfn>;                         <i  data-doc="_CASC_FILE_ENTRY::FileNameHash">// Jenkins hash of the file name</i></td></tr>
<tr><th id="60">60</th><td>    <a class="typedef" href="CascPort.h.html#DWORD" title='DWORD' data-type='unsigned int' data-ref="DWORD" >DWORD</a> <dfn class="tu decl" id="_CASC_FILE_ENTRY::FileDataId" title='_CASC_FILE_ENTRY::FileDataId' data-type='DWORD' data-ref="_CASC_FILE_ENTRY::FileDataId" >FileDataId</dfn>;                               <i  data-doc="_CASC_FILE_ENTRY::FileDataId">// File Data Index</i></td></tr>
<tr><th id="61">61</th><td>    <a class="typedef" href="CascPort.h.html#DWORD" title='DWORD' data-type='unsigned int' data-ref="DWORD" >DWORD</a> <dfn class="tu decl" id="_CASC_FILE_ENTRY::Locales" title='_CASC_FILE_ENTRY::Locales' data-type='DWORD' data-ref="_CASC_FILE_ENTRY::Locales" >Locales</dfn>;                                  <i  data-doc="_CASC_FILE_ENTRY::Locales">// Locale flags of the file</i></td></tr>
<tr><th id="62">62</th><td></td></tr>
<tr><th id="63">63</th><td>} <dfn class="typedef" id="CASC_FILE_ENTRY" title='CASC_FILE_ENTRY' data-type='struct _CASC_FILE_ENTRY' data-ref="CASC_FILE_ENTRY" >CASC_FILE_ENTRY</dfn>, *<dfn class="typedef" id="PCASC_FILE_ENTRY" title='PCASC_FILE_ENTRY' data-type='struct _CASC_FILE_ENTRY *' data-ref="PCASC_FILE_ENTRY" >PCASC_FILE_ENTRY</dfn>;</td></tr>
<tr><th id="64">64</th><td></td></tr>
<tr><th id="65">65</th><td><b>struct</b> <dfn class="type def" id="TRootHandler_WoW6" title='TRootHandler_WoW6' data-ref="TRootHandler_WoW6" >TRootHandler_WoW6</dfn> : <b>public</b> <a class="type" href="common/RootHandler.h.html#TRootHandler" title='TRootHandler' data-ref="TRootHandler" >TRootHandler</a></td></tr>
<tr><th id="66">66</th><td>{</td></tr>
<tr><th id="67">67</th><td>    <i  data-doc="TRootHandler_WoW6::FileTable">// Linear global list of file entries</i></td></tr>
<tr><th id="68">68</th><td>    <a class="typedef" href="common/DynamicArray.h.html#DYNAMIC_ARRAY" title='DYNAMIC_ARRAY' data-type='struct _DYNAMIC_ARRAY' data-ref="DYNAMIC_ARRAY" >DYNAMIC_ARRAY</a> <dfn class="tu decl" id="TRootHandler_WoW6::FileTable" title='TRootHandler_WoW6::FileTable' data-type='DYNAMIC_ARRAY' data-ref="TRootHandler_WoW6::FileTable" >FileTable</dfn>;</td></tr>
<tr><th id="69">69</th><td></td></tr>
<tr><th id="70">70</th><td>    <i  data-doc="TRootHandler_WoW6::pRootMap">// Global map of FileName -&gt; FileEntry</i></td></tr>
<tr><th id="71">71</th><td>    <a class="typedef" href="common/Map.h.html#PCASC_MAP" title='PCASC_MAP' data-type='struct _CASC_MAP *' data-ref="PCASC_MAP" >PCASC_MAP</a> <dfn class="tu decl" id="TRootHandler_WoW6::pRootMap" title='TRootHandler_WoW6::pRootMap' data-type='PCASC_MAP' data-ref="TRootHandler_WoW6::pRootMap" >pRootMap</dfn>;</td></tr>
<tr><th id="72">72</th><td></td></tr>
<tr><th id="73">73</th><td>    <i  data-doc="TRootHandler_WoW6::dwTotalFileCount">// For counting files</i></td></tr>
<tr><th id="74">74</th><td>    <a class="typedef" href="CascPort.h.html#DWORD" title='DWORD' data-type='unsigned int' data-ref="DWORD" >DWORD</a> <dfn class="tu decl" id="TRootHandler_WoW6::dwTotalFileCount" title='TRootHandler_WoW6::dwTotalFileCount' data-type='DWORD' data-ref="TRootHandler_WoW6::dwTotalFileCount" >dwTotalFileCount</dfn>;</td></tr>
<tr><th id="75">75</th><td>    <a class="typedef" href="CascPort.h.html#DWORD" title='DWORD' data-type='unsigned int' data-ref="DWORD" >DWORD</a> <dfn class="tu decl" id="TRootHandler_WoW6::FileDataId" title='TRootHandler_WoW6::FileDataId' data-type='DWORD' data-ref="TRootHandler_WoW6::FileDataId" >FileDataId</dfn>;</td></tr>
<tr><th id="76">76</th><td>};</td></tr>
<tr><th id="77">77</th><td></td></tr>
<tr><th id="78">78</th><td><i>// Prototype for root file parsing routine</i></td></tr>
<tr><th id="79">79</th><td><b>typedef</b> <em>int</em> (*<dfn class="typedef" id="PARSE_ROOT" title='PARSE_ROOT' data-type='int (*)(TRootHandler_WoW6 *, PCASC_ROOT_BLOCK)' data-ref="PARSE_ROOT" >PARSE_ROOT</dfn>)(<a class="type" href="#TRootHandler_WoW6" title='TRootHandler_WoW6' data-ref="TRootHandler_WoW6" >TRootHandler_WoW6</a> * <dfn class="local col1 decl" id="1pRootHandler" title='pRootHandler' data-type='TRootHandler_WoW6 *' data-ref="1pRootHandler" >pRootHandler</dfn>, <a class="typedef" href="#PCASC_ROOT_BLOCK" title='PCASC_ROOT_BLOCK' data-type='struct _CASC_ROOT_BLOCK *' data-ref="PCASC_ROOT_BLOCK" >PCASC_ROOT_BLOCK</a> <dfn class="local col2 decl" id="2pBlockInfo" title='pBlockInfo' data-type='PCASC_ROOT_BLOCK' data-ref="2pBlockInfo" >pBlockInfo</dfn>);</td></tr>
<tr><th id="80">80</th><td></td></tr>
<tr><th id="81">81</th><td><i  data-doc="_ZL16IsFileDataIdNamePKc">//-----------------------------------------------------------------------------</i></td></tr>
<tr><th id="82">82</th><td><i  data-doc="_ZL16IsFileDataIdNamePKc">// Local functions</i></td></tr>
<tr><th id="83">83</th><td></td></tr>
<tr><th id="84">84</th><td><em>static</em> <em>bool</em> <dfn class="tu decl def" id="_ZL16IsFileDataIdNamePKc" title='IsFileDataIdName' data-type='bool IsFileDataIdName(const char * szFileName)' data-ref="_ZL16IsFileDataIdNamePKc" >IsFileDataIdName</dfn>(<em>const</em> <em>char</em> * <dfn class="local col3 decl" id="3szFileName" title='szFileName' data-type='const char *' data-ref="3szFileName" >szFileName</dfn>)</td></tr>
<tr><th id="85">85</th><td>{</td></tr>
<tr><th id="86">86</th><td>    <a class="typedef" href="CascPort.h.html#BYTE" title='BYTE' data-type='unsigned char' data-ref="BYTE" >BYTE</a> <dfn class="local col4 decl" id="4BinaryValue" title='BinaryValue' data-type='BYTE [4]' data-ref="4BinaryValue" >BinaryValue</dfn>[<var>4</var>];</td></tr>
<tr><th id="87">87</th><td></td></tr>
<tr><th id="88">88</th><td>    <i>// File name must begin with "File", case insensitive</i></td></tr>
<tr><th id="89">89</th><td>    <b>if</b>(<a class="ref" href="common/Common.h.html#AsciiToUpperTable_BkSlash" title='AsciiToUpperTable_BkSlash' data-ref="AsciiToUpperTable_BkSlash" id="AsciiToUpperTable_BkSlash" >AsciiToUpperTable_BkSlash</a>[<a class="local col3 ref" href="#3szFileName" title='szFileName' data-ref="3szFileName" >szFileName</a>[<var>0</var>]] == <kdb>'F'</kdb> &amp;&amp;</td></tr>
<tr><th id="90">90</th><td>       <a class="ref" href="common/Common.h.html#AsciiToUpperTable_BkSlash" title='AsciiToUpperTable_BkSlash' data-ref="AsciiToUpperTable_BkSlash" id="AsciiToUpperTable_BkSlash" >AsciiToUpperTable_BkSlash</a>[<a class="local col3 ref" href="#3szFileName" title='szFileName' data-ref="3szFileName" >szFileName</a>[<var>1</var>]] == <kdb>'I'</kdb> &amp;&amp;</td></tr>
<tr><th id="91">91</th><td>       <a class="ref" href="common/Common.h.html#AsciiToUpperTable_BkSlash" title='AsciiToUpperTable_BkSlash' data-ref="AsciiToUpperTable_BkSlash" id="AsciiToUpperTable_BkSlash" >AsciiToUpperTable_BkSlash</a>[<a class="local col3 ref" href="#3szFileName" title='szFileName' data-ref="3szFileName" >szFileName</a>[<var>2</var>]] == <kdb>'L'</kdb> &amp;&amp;</td></tr>
<tr><th id="92">92</th><td>       <a class="ref" href="common/Common.h.html#AsciiToUpperTable_BkSlash" title='AsciiToUpperTable_BkSlash' data-ref="AsciiToUpperTable_BkSlash" id="AsciiToUpperTable_BkSlash" >AsciiToUpperTable_BkSlash</a>[<a class="local col3 ref" href="#3szFileName" title='szFileName' data-ref="3szFileName" >szFileName</a>[<var>3</var>]] == <kdb>'E'</kdb>)</td></tr>
<tr><th id="93">93</th><td>    {</td></tr>
<tr><th id="94">94</th><td>        <i>// Then, 8 hexadecimal digits must follow</i></td></tr>
<tr><th id="95">95</th><td>        <b>if</b>(<a class="ref" href="common/Common.h.html#_Z21ConvertStringToBinaryPKcmPh" title='ConvertStringToBinary' data-ref="_Z21ConvertStringToBinaryPKcmPh" id="_Z21ConvertStringToBinaryPKcmPh" >ConvertStringToBinary</a>(<a class="local col3 ref" href="#3szFileName" title='szFileName' data-ref="3szFileName" >szFileName</a> + <var>4</var>, <var>8</var>, <a class="local col4 ref" href="#4BinaryValue" title='BinaryValue' data-ref="4BinaryValue" >BinaryValue</a>) == <a class="macro" href="CascPort.h.html#204" title="0" data-ref="_M/ERROR_SUCCESS">ERROR_SUCCESS</a>)</td></tr>
<tr><th id="96">96</th><td>        {</td></tr>
<tr><th id="97">97</th><td>            <i>// Must be followed by an extension or end-of-string</i></td></tr>
<tr><th id="98">98</th><td>            <b>return</b> (<a class="local col3 ref" href="#3szFileName" title='szFileName' data-ref="3szFileName" >szFileName</a>[<var>0x0C</var>] == <var>0</var> || <a class="local col3 ref" href="#3szFileName" title='szFileName' data-ref="3szFileName" >szFileName</a>[<var>0x0C</var>] == <kdb>'.'</kdb>);</td></tr>
<tr><th id="99">99</th><td>        }</td></tr>
<tr><th id="100">100</th><td>    }</td></tr>
<tr><th id="101">101</th><td></td></tr>
<tr><th id="102">102</th><td>    <b>return</b> <b>false</b>;</td></tr>
<tr><th id="103">103</th><td>}</td></tr>
<tr><th id="104">104</th><td></td></tr>
<tr><th id="105">105</th><td><i>// Search by FileDataId</i></td></tr>
<tr><th id="106">106</th><td><a class="typedef" href="#PCASC_FILE_ENTRY" title='PCASC_FILE_ENTRY' data-type='struct _CASC_FILE_ENTRY *' data-ref="PCASC_FILE_ENTRY" >PCASC_FILE_ENTRY</a> <dfn class="decl def" id="_Z13FindRootEntryR14_DYNAMIC_ARRAYj" title='FindRootEntry' data-ref="_Z13FindRootEntryR14_DYNAMIC_ARRAYj" >FindRootEntry</dfn>(<a class="typedef" href="common/DynamicArray.h.html#DYNAMIC_ARRAY" title='DYNAMIC_ARRAY' data-type='struct _DYNAMIC_ARRAY' data-ref="DYNAMIC_ARRAY" >DYNAMIC_ARRAY</a> &amp; <dfn class="local col5 decl" id="5FileTable" title='FileTable' data-type='DYNAMIC_ARRAY &amp;' data-ref="5FileTable" >FileTable</dfn>, <a class="typedef" href="CascPort.h.html#DWORD" title='DWORD' data-type='unsigned int' data-ref="DWORD" >DWORD</a> <dfn class="local col6 decl" id="6FileDataId" title='FileDataId' data-type='DWORD' data-ref="6FileDataId" >FileDataId</dfn>)</td></tr>
<tr><th id="107">107</th><td>{</td></tr>
<tr><th id="108">108</th><td>    <a class="typedef" href="#PCASC_FILE_ENTRY" title='PCASC_FILE_ENTRY' data-type='struct _CASC_FILE_ENTRY *' data-ref="PCASC_FILE_ENTRY" >PCASC_FILE_ENTRY</a> <dfn class="local col7 decl" id="7pStartEntry" title='pStartEntry' data-type='PCASC_FILE_ENTRY' data-ref="7pStartEntry" >pStartEntry</dfn> = (<a class="typedef" href="#PCASC_FILE_ENTRY" title='PCASC_FILE_ENTRY' data-type='struct _CASC_FILE_ENTRY *' data-ref="PCASC_FILE_ENTRY" >PCASC_FILE_ENTRY</a>)<a class="local col5 ref" href="#5FileTable" title='FileTable' data-ref="5FileTable" >FileTable</a>.<a class="ref" href="common/DynamicArray.h.html#_DYNAMIC_ARRAY::ItemArray" title='_DYNAMIC_ARRAY::ItemArray' data-ref="_DYNAMIC_ARRAY::ItemArray" id="_DYNAMIC_ARRAY::ItemArray" >ItemArray</a>;</td></tr>
<tr><th id="109">109</th><td>    <a class="typedef" href="#PCASC_FILE_ENTRY" title='PCASC_FILE_ENTRY' data-type='struct _CASC_FILE_ENTRY *' data-ref="PCASC_FILE_ENTRY" >PCASC_FILE_ENTRY</a> <dfn class="local col8 decl" id="8pMidlEntry" title='pMidlEntry' data-type='PCASC_FILE_ENTRY' data-ref="8pMidlEntry" >pMidlEntry</dfn>;</td></tr>
<tr><th id="110">110</th><td>    <a class="typedef" href="#PCASC_FILE_ENTRY" title='PCASC_FILE_ENTRY' data-type='struct _CASC_FILE_ENTRY *' data-ref="PCASC_FILE_ENTRY" >PCASC_FILE_ENTRY</a> <dfn class="local col9 decl" id="9pEndEntry" title='pEndEntry' data-type='PCASC_FILE_ENTRY' data-ref="9pEndEntry" >pEndEntry</dfn> = <a class="local col7 ref" href="#7pStartEntry" title='pStartEntry' data-ref="7pStartEntry" >pStartEntry</a> + <a class="local col5 ref" href="#5FileTable" title='FileTable' data-ref="5FileTable" >FileTable</a>.<a class="ref" href="common/DynamicArray.h.html#_DYNAMIC_ARRAY::ItemCount" title='_DYNAMIC_ARRAY::ItemCount' data-ref="_DYNAMIC_ARRAY::ItemCount" id="_DYNAMIC_ARRAY::ItemCount" >ItemCount</a> - <var>1</var>;</td></tr>
<tr><th id="111">111</th><td>    <em>int</em> <dfn class="local col0 decl" id="10nResult" title='nResult' data-type='int' data-ref="10nResult" >nResult</dfn>;</td></tr>
<tr><th id="112">112</th><td></td></tr>
<tr><th id="113">113</th><td>    <i>// Perform binary search on the table</i></td></tr>
<tr><th id="114">114</th><td>    <b>while</b>(<a class="local col7 ref" href="#7pStartEntry" title='pStartEntry' data-ref="7pStartEntry" >pStartEntry</a> &lt; <a class="local col9 ref" href="#9pEndEntry" title='pEndEntry' data-ref="9pEndEntry" >pEndEntry</a>)</td></tr>
<tr><th id="115">115</th><td>    {</td></tr>
<tr><th id="116">116</th><td>        <i>// Calculate the middle of the interval</i></td></tr>
<tr><th id="117">117</th><td>        <a class="local col8 ref" href="#8pMidlEntry" title='pMidlEntry' data-ref="8pMidlEntry" >pMidlEntry</a> = <a class="local col7 ref" href="#7pStartEntry" title='pStartEntry' data-ref="7pStartEntry" >pStartEntry</a> + ((<a class="local col9 ref" href="#9pEndEntry" title='pEndEntry' data-ref="9pEndEntry" >pEndEntry</a> - <a class="local col7 ref" href="#7pStartEntry" title='pStartEntry' data-ref="7pStartEntry" >pStartEntry</a>) / <var>2</var>);</td></tr>
<tr><th id="118">118</th><td></td></tr>
<tr><th id="119">119</th><td>        <i>// Did we find it?</i></td></tr>
<tr><th id="120">120</th><td>        <a class="local col0 ref" href="#10nResult" title='nResult' data-ref="10nResult" >nResult</a> = (<em>int</em>)<a class="local col6 ref" href="#6FileDataId" title='FileDataId' data-ref="6FileDataId" >FileDataId</a> - (<em>int</em>)<a class="local col8 ref" href="#8pMidlEntry" title='pMidlEntry' data-ref="8pMidlEntry" >pMidlEntry</a>-&gt;<a class="tu ref" href="#_CASC_FILE_ENTRY::FileDataId" title='_CASC_FILE_ENTRY::FileDataId' data-use='r' data-ref="_CASC_FILE_ENTRY::FileDataId" >FileDataId</a>;</td></tr>
<tr><th id="121">121</th><td>        <b>if</b>(<a class="local col0 ref" href="#10nResult" title='nResult' data-ref="10nResult" >nResult</a> == <var>0</var>)</td></tr>
<tr><th id="122">122</th><td>            <b>return</b> <a class="local col8 ref" href="#8pMidlEntry" title='pMidlEntry' data-ref="8pMidlEntry" >pMidlEntry</a>;</td></tr>
<tr><th id="123">123</th><td></td></tr>
<tr><th id="124">124</th><td>        <i>// Move the interval to the left or right</i></td></tr>
<tr><th id="125">125</th><td>        (<a class="local col0 ref" href="#10nResult" title='nResult' data-ref="10nResult" >nResult</a> &lt; <var>0</var>) ? <a class="local col9 ref" href="#9pEndEntry" title='pEndEntry' data-ref="9pEndEntry" >pEndEntry</a> = <a class="local col8 ref" href="#8pMidlEntry" title='pMidlEntry' data-ref="8pMidlEntry" >pMidlEntry</a> : <a class="local col7 ref" href="#7pStartEntry" title='pStartEntry' data-ref="7pStartEntry" >pStartEntry</a> = <a class="local col8 ref" href="#8pMidlEntry" title='pMidlEntry' data-ref="8pMidlEntry" >pMidlEntry</a> + <var>1</var>;</td></tr>
<tr><th id="126">126</th><td>    }</td></tr>
<tr><th id="127">127</th><td></td></tr>
<tr><th id="128">128</th><td>    <b>return</b> <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="129">129</th><td>}</td></tr>
<tr><th id="130">130</th><td></td></tr>
<tr><th id="131">131</th><td><i>// Search by file name hash</i></td></tr>
<tr><th id="132">132</th><td><i>// Also used in CascSearchFile</i></td></tr>
<tr><th id="133">133</th><td><a class="typedef" href="#PCASC_FILE_ENTRY" title='PCASC_FILE_ENTRY' data-type='struct _CASC_FILE_ENTRY *' data-ref="PCASC_FILE_ENTRY" >PCASC_FILE_ENTRY</a> <dfn class="decl def" id="_Z13FindRootEntryP9_CASC_MAPPKcPj" title='FindRootEntry' data-ref="_Z13FindRootEntryP9_CASC_MAPPKcPj" >FindRootEntry</dfn>(<a class="typedef" href="common/Map.h.html#PCASC_MAP" title='PCASC_MAP' data-type='struct _CASC_MAP *' data-ref="PCASC_MAP" >PCASC_MAP</a> <dfn class="local col1 decl" id="11pRootMap" title='pRootMap' data-type='PCASC_MAP' data-ref="11pRootMap" >pRootMap</dfn>, <em>const</em> <em>char</em> * <dfn class="local col2 decl" id="12szFileName" title='szFileName' data-type='const char *' data-ref="12szFileName" >szFileName</dfn>, <a class="typedef" href="CascPort.h.html#DWORD" title='DWORD' data-type='unsigned int' data-ref="DWORD" >DWORD</a> * <dfn class="local col3 decl" id="13PtrTableIndex" title='PtrTableIndex' data-type='DWORD *' data-ref="13PtrTableIndex" >PtrTableIndex</dfn>)</td></tr>
<tr><th id="134">134</th><td>{</td></tr>
<tr><th id="135">135</th><td>    <i>// Calculate the HASH value of the normalized file name</i></td></tr>
<tr><th id="136">136</th><td>    <a class="typedef" href="CascPort.h.html#ULONGLONG" title='ULONGLONG' data-type='unsigned long long' data-ref="ULONGLONG" >ULONGLONG</a> <dfn class="local col4 decl" id="14FileNameHash" title='FileNameHash' data-type='ULONGLONG' data-ref="14FileNameHash" >FileNameHash</dfn> = <a class="ref" href="common/Common.h.html#_Z16CalcFileNameHashPKc" title='CalcFileNameHash' data-ref="_Z16CalcFileNameHashPKc" id="_Z16CalcFileNameHashPKc" >CalcFileNameHash</a>(<a class="local col2 ref" href="#12szFileName" title='szFileName' data-ref="12szFileName" >szFileName</a>);</td></tr>
<tr><th id="137">137</th><td></td></tr>
<tr><th id="138">138</th><td>    <i>// Perform the hash search</i></td></tr>
<tr><th id="139">139</th><td>    <b>return</b> (<a class="typedef" href="#PCASC_FILE_ENTRY" title='PCASC_FILE_ENTRY' data-type='struct _CASC_FILE_ENTRY *' data-ref="PCASC_FILE_ENTRY" >PCASC_FILE_ENTRY</a>)<a class="ref" href="common/Map.h.html#_Z14Map_FindObjectP9_CASC_MAPPvPj" title='Map_FindObject' data-ref="_Z14Map_FindObjectP9_CASC_MAPPvPj" id="_Z14Map_FindObjectP9_CASC_MAPPvPj" >Map_FindObject</a>(<a class="local col1 ref" href="#11pRootMap" title='pRootMap' data-ref="11pRootMap" >pRootMap</a>, &amp;<a class="local col4 ref" href="#14FileNameHash" title='FileNameHash' data-ref="14FileNameHash" >FileNameHash</a>, <a class="local col3 ref" href="#13PtrTableIndex" title='PtrTableIndex' data-ref="13PtrTableIndex" >PtrTableIndex</a>);</td></tr>
<tr><th id="140">140</th><td>}</td></tr>
<tr><th id="141">141</th><td></td></tr>
<tr><th id="142">142</th><td><a class="typedef" href="CascPort.h.html#LPBYTE" title='LPBYTE' data-type='BYTE *' data-ref="LPBYTE" >LPBYTE</a> <dfn class="decl def" id="_Z17VerifyLocaleBlockP16_CASC_ROOT_BLOCKPhS1_" title='VerifyLocaleBlock' data-ref="_Z17VerifyLocaleBlockP16_CASC_ROOT_BLOCKPhS1_" >VerifyLocaleBlock</dfn>(<a class="typedef" href="#PCASC_ROOT_BLOCK" title='PCASC_ROOT_BLOCK' data-type='struct _CASC_ROOT_BLOCK *' data-ref="PCASC_ROOT_BLOCK" >PCASC_ROOT_BLOCK</a> <dfn class="local col5 decl" id="15pBlockInfo" title='pBlockInfo' data-type='PCASC_ROOT_BLOCK' data-ref="15pBlockInfo" >pBlockInfo</dfn>, <a class="typedef" href="CascPort.h.html#LPBYTE" title='LPBYTE' data-type='BYTE *' data-ref="LPBYTE" >LPBYTE</a> <dfn class="local col6 decl" id="16pbFilePointer" title='pbFilePointer' data-type='LPBYTE' data-ref="16pbFilePointer" >pbFilePointer</dfn>, <a class="typedef" href="CascPort.h.html#LPBYTE" title='LPBYTE' data-type='BYTE *' data-ref="LPBYTE" >LPBYTE</a> <dfn class="local col7 decl" id="17pbFileEnd" title='pbFileEnd' data-type='LPBYTE' data-ref="17pbFileEnd" >pbFileEnd</dfn>)</td></tr>
<tr><th id="143">143</th><td>{</td></tr>
<tr><th id="144">144</th><td>    <i>// Validate the file locale block</i></td></tr>
<tr><th id="145">145</th><td>    <a class="local col5 ref" href="#15pBlockInfo" title='pBlockInfo' data-ref="15pBlockInfo" >pBlockInfo</a>-&gt;<a class="tu ref" href="#_CASC_ROOT_BLOCK::pLocaleBlockHdr" title='_CASC_ROOT_BLOCK::pLocaleBlockHdr' data-use='w' data-ref="_CASC_ROOT_BLOCK::pLocaleBlockHdr" >pLocaleBlockHdr</a> = (<a class="typedef" href="#PFILE_LOCALE_BLOCK" title='PFILE_LOCALE_BLOCK' data-type='struct _FILE_LOCALE_BLOCK *' data-ref="PFILE_LOCALE_BLOCK" >PFILE_LOCALE_BLOCK</a>)<a class="local col6 ref" href="#16pbFilePointer" title='pbFilePointer' data-ref="16pbFilePointer" >pbFilePointer</a>;</td></tr>
<tr><th id="146">146</th><td>    <a class="local col6 ref" href="#16pbFilePointer" title='pbFilePointer' data-ref="16pbFilePointer" >pbFilePointer</a> = (<a class="typedef" href="CascPort.h.html#LPBYTE" title='LPBYTE' data-type='BYTE *' data-ref="LPBYTE" >LPBYTE</a>)(<a class="local col5 ref" href="#15pBlockInfo" title='pBlockInfo' data-ref="15pBlockInfo" >pBlockInfo</a>-&gt;<a class="tu ref" href="#_CASC_ROOT_BLOCK::pLocaleBlockHdr" title='_CASC_ROOT_BLOCK::pLocaleBlockHdr' data-use='r' data-ref="_CASC_ROOT_BLOCK::pLocaleBlockHdr" >pLocaleBlockHdr</a> + <var>1</var>);</td></tr>
<tr><th id="147">147</th><td>    <b>if</b>(<a class="local col6 ref" href="#16pbFilePointer" title='pbFilePointer' data-ref="16pbFilePointer" >pbFilePointer</a> &gt; <a class="local col7 ref" href="#17pbFileEnd" title='pbFileEnd' data-ref="17pbFileEnd" >pbFileEnd</a>)</td></tr>
<tr><th id="148">148</th><td>        <b>return</b> <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="149">149</th><td></td></tr>
<tr><th id="150">150</th><td>    <i>// Validate the array of 32-bit integers</i></td></tr>
<tr><th id="151">151</th><td>    <a class="local col5 ref" href="#15pBlockInfo" title='pBlockInfo' data-ref="15pBlockInfo" >pBlockInfo</a>-&gt;<a class="tu ref" href="#_CASC_ROOT_BLOCK::FileDataIds" title='_CASC_ROOT_BLOCK::FileDataIds' data-use='w' data-ref="_CASC_ROOT_BLOCK::FileDataIds" >FileDataIds</a> = (<a class="typedef" href="CascPort.h.html#PDWORD" title='PDWORD' data-type='DWORD *' data-ref="PDWORD" >PDWORD</a>)<a class="local col6 ref" href="#16pbFilePointer" title='pbFilePointer' data-ref="16pbFilePointer" >pbFilePointer</a>;</td></tr>
<tr><th id="152">152</th><td>    <a class="local col6 ref" href="#16pbFilePointer" title='pbFilePointer' data-ref="16pbFilePointer" >pbFilePointer</a> = (<a class="typedef" href="CascPort.h.html#LPBYTE" title='LPBYTE' data-type='BYTE *' data-ref="LPBYTE" >LPBYTE</a>)(<a class="local col5 ref" href="#15pBlockInfo" title='pBlockInfo' data-ref="15pBlockInfo" >pBlockInfo</a>-&gt;<a class="tu ref" href="#_CASC_ROOT_BLOCK::FileDataIds" title='_CASC_ROOT_BLOCK::FileDataIds' data-use='r' data-ref="_CASC_ROOT_BLOCK::FileDataIds" >FileDataIds</a> + <a class="local col5 ref" href="#15pBlockInfo" title='pBlockInfo' data-ref="15pBlockInfo" >pBlockInfo</a>-&gt;<a class="tu ref" href="#_CASC_ROOT_BLOCK::pLocaleBlockHdr" title='_CASC_ROOT_BLOCK::pLocaleBlockHdr' data-use='m' data-ref="_CASC_ROOT_BLOCK::pLocaleBlockHdr" >pLocaleBlockHdr</a>-&gt;<a class="tu ref" href="#_FILE_LOCALE_BLOCK::NumberOfFiles" title='_FILE_LOCALE_BLOCK::NumberOfFiles' data-use='r' data-ref="_FILE_LOCALE_BLOCK::NumberOfFiles" >NumberOfFiles</a>);</td></tr>
<tr><th id="153">153</th><td>    <b>if</b>(<a class="local col6 ref" href="#16pbFilePointer" title='pbFilePointer' data-ref="16pbFilePointer" >pbFilePointer</a> &gt; <a class="local col7 ref" href="#17pbFileEnd" title='pbFileEnd' data-ref="17pbFileEnd" >pbFileEnd</a>)</td></tr>
<tr><th id="154">154</th><td>        <b>return</b> <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="155">155</th><td></td></tr>
<tr><th id="156">156</th><td>    <i>// Validate the array of root entries</i></td></tr>
<tr><th id="157">157</th><td>    <a class="local col5 ref" href="#15pBlockInfo" title='pBlockInfo' data-ref="15pBlockInfo" >pBlockInfo</a>-&gt;<a class="tu ref" href="#_CASC_ROOT_BLOCK::pRootEntries" title='_CASC_ROOT_BLOCK::pRootEntries' data-use='w' data-ref="_CASC_ROOT_BLOCK::pRootEntries" >pRootEntries</a> = (<a class="typedef" href="#PFILE_ROOT_ENTRY" title='PFILE_ROOT_ENTRY' data-type='struct _FILE_ROOT_ENTRY *' data-ref="PFILE_ROOT_ENTRY" >PFILE_ROOT_ENTRY</a>)<a class="local col6 ref" href="#16pbFilePointer" title='pbFilePointer' data-ref="16pbFilePointer" >pbFilePointer</a>;</td></tr>
<tr><th id="158">158</th><td>    <a class="local col6 ref" href="#16pbFilePointer" title='pbFilePointer' data-ref="16pbFilePointer" >pbFilePointer</a> = (<a class="typedef" href="CascPort.h.html#LPBYTE" title='LPBYTE' data-type='BYTE *' data-ref="LPBYTE" >LPBYTE</a>)(<a class="local col5 ref" href="#15pBlockInfo" title='pBlockInfo' data-ref="15pBlockInfo" >pBlockInfo</a>-&gt;<a class="tu ref" href="#_CASC_ROOT_BLOCK::pRootEntries" title='_CASC_ROOT_BLOCK::pRootEntries' data-use='r' data-ref="_CASC_ROOT_BLOCK::pRootEntries" >pRootEntries</a> + <a class="local col5 ref" href="#15pBlockInfo" title='pBlockInfo' data-ref="15pBlockInfo" >pBlockInfo</a>-&gt;<a class="tu ref" href="#_CASC_ROOT_BLOCK::pLocaleBlockHdr" title='_CASC_ROOT_BLOCK::pLocaleBlockHdr' data-use='m' data-ref="_CASC_ROOT_BLOCK::pLocaleBlockHdr" >pLocaleBlockHdr</a>-&gt;<a class="tu ref" href="#_FILE_LOCALE_BLOCK::NumberOfFiles" title='_FILE_LOCALE_BLOCK::NumberOfFiles' data-use='r' data-ref="_FILE_LOCALE_BLOCK::NumberOfFiles" >NumberOfFiles</a>);</td></tr>
<tr><th id="159">159</th><td>    <b>if</b>(<a class="local col6 ref" href="#16pbFilePointer" title='pbFilePointer' data-ref="16pbFilePointer" >pbFilePointer</a> &gt; <a class="local col7 ref" href="#17pbFileEnd" title='pbFileEnd' data-ref="17pbFileEnd" >pbFileEnd</a>)</td></tr>
<tr><th id="160">160</th><td>        <b>return</b> <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="161">161</th><td></td></tr>
<tr><th id="162">162</th><td>    <i>// Return the position of the next block</i></td></tr>
<tr><th id="163">163</th><td>    <b>return</b> <a class="local col6 ref" href="#16pbFilePointer" title='pbFilePointer' data-ref="16pbFilePointer" >pbFilePointer</a>;</td></tr>
<tr><th id="164">164</th><td>}</td></tr>
<tr><th id="165">165</th><td></td></tr>
<tr><th id="166">166</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="_ZL20ParseRoot_CountFilesP17TRootHandler_WoW6P16_CASC_ROOT_BLOCK" title='ParseRoot_CountFiles' data-type='int ParseRoot_CountFiles(TRootHandler_WoW6 * pRootHandler, PCASC_ROOT_BLOCK pRootBlock)' data-ref="_ZL20ParseRoot_CountFilesP17TRootHandler_WoW6P16_CASC_ROOT_BLOCK" >ParseRoot_CountFiles</dfn>(</td></tr>
<tr><th id="167">167</th><td>    <a class="type" href="#TRootHandler_WoW6" title='TRootHandler_WoW6' data-ref="TRootHandler_WoW6" >TRootHandler_WoW6</a> * <dfn class="local col8 decl" id="18pRootHandler" title='pRootHandler' data-type='TRootHandler_WoW6 *' data-ref="18pRootHandler" >pRootHandler</dfn>,</td></tr>
<tr><th id="168">168</th><td>    <a class="typedef" href="#PCASC_ROOT_BLOCK" title='PCASC_ROOT_BLOCK' data-type='struct _CASC_ROOT_BLOCK *' data-ref="PCASC_ROOT_BLOCK" >PCASC_ROOT_BLOCK</a> <dfn class="local col9 decl" id="19pRootBlock" title='pRootBlock' data-type='PCASC_ROOT_BLOCK' data-ref="19pRootBlock" >pRootBlock</dfn>)</td></tr>
<tr><th id="169">169</th><td>{</td></tr>
<tr><th id="170">170</th><td>    <i>// Add the file count to the total file count</i></td></tr>
<tr><th id="171">171</th><td>    <a class="local col8 ref" href="#18pRootHandler" title='pRootHandler' data-ref="18pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::dwTotalFileCount" title='TRootHandler_WoW6::dwTotalFileCount' data-use='w' data-ref="TRootHandler_WoW6::dwTotalFileCount" >dwTotalFileCount</a> += <a class="local col9 ref" href="#19pRootBlock" title='pRootBlock' data-ref="19pRootBlock" >pRootBlock</a>-&gt;<a class="tu ref" href="#_CASC_ROOT_BLOCK::pLocaleBlockHdr" title='_CASC_ROOT_BLOCK::pLocaleBlockHdr' data-use='m' data-ref="_CASC_ROOT_BLOCK::pLocaleBlockHdr" >pLocaleBlockHdr</a>-&gt;<a class="tu ref" href="#_FILE_LOCALE_BLOCK::NumberOfFiles" title='_FILE_LOCALE_BLOCK::NumberOfFiles' data-use='r' data-ref="_FILE_LOCALE_BLOCK::NumberOfFiles" >NumberOfFiles</a>;</td></tr>
<tr><th id="172">172</th><td>    <b>return</b> <a class="macro" href="CascPort.h.html#204" title="0" data-ref="_M/ERROR_SUCCESS">ERROR_SUCCESS</a>;</td></tr>
<tr><th id="173">173</th><td>}</td></tr>
<tr><th id="174">174</th><td></td></tr>
<tr><th id="175">175</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="_ZL24ParseRoot_AddRootEntriesP17TRootHandler_WoW6P16_CASC_ROOT_BLOCK" title='ParseRoot_AddRootEntries' data-type='int ParseRoot_AddRootEntries(TRootHandler_WoW6 * pRootHandler, PCASC_ROOT_BLOCK pRootBlock)' data-ref="_ZL24ParseRoot_AddRootEntriesP17TRootHandler_WoW6P16_CASC_ROOT_BLOCK" >ParseRoot_AddRootEntries</dfn>(</td></tr>
<tr><th id="176">176</th><td>    <a class="type" href="#TRootHandler_WoW6" title='TRootHandler_WoW6' data-ref="TRootHandler_WoW6" >TRootHandler_WoW6</a> * <dfn class="local col0 decl" id="20pRootHandler" title='pRootHandler' data-type='TRootHandler_WoW6 *' data-ref="20pRootHandler" >pRootHandler</dfn>,</td></tr>
<tr><th id="177">177</th><td>    <a class="typedef" href="#PCASC_ROOT_BLOCK" title='PCASC_ROOT_BLOCK' data-type='struct _CASC_ROOT_BLOCK *' data-ref="PCASC_ROOT_BLOCK" >PCASC_ROOT_BLOCK</a> <dfn class="local col1 decl" id="21pRootBlock" title='pRootBlock' data-type='PCASC_ROOT_BLOCK' data-ref="21pRootBlock" >pRootBlock</dfn>)</td></tr>
<tr><th id="178">178</th><td>{</td></tr>
<tr><th id="179">179</th><td>    <a class="typedef" href="#PCASC_FILE_ENTRY" title='PCASC_FILE_ENTRY' data-type='struct _CASC_FILE_ENTRY *' data-ref="PCASC_FILE_ENTRY" >PCASC_FILE_ENTRY</a> <dfn class="local col2 decl" id="22pFileEntry" title='pFileEntry' data-type='PCASC_FILE_ENTRY' data-ref="22pFileEntry" >pFileEntry</dfn>;</td></tr>
<tr><th id="180">180</th><td></td></tr>
<tr><th id="181">181</th><td>    <i>// Sanity checks</i></td></tr>
<tr><th id="182">182</th><td>    <a class="macro" href="../../../../include/assert.h.html#50" title="(static_cast&lt;void&gt; (0))" data-ref="_M/assert">assert</a>(pRootHandler-&gt;FileTable.ItemArray != NULL);</td></tr>
<tr><th id="183">183</th><td>    <a class="macro" href="../../../../include/assert.h.html#50" title="(static_cast&lt;void&gt; (0))" data-ref="_M/assert">assert</a>(pRootHandler-&gt;FileTable.ItemCountMax != <var>0</var>);</td></tr>
<tr><th id="184">184</th><td></td></tr>
<tr><th id="185">185</th><td>    <i>// WoW.exe (build 19116): Blocks with zero files are skipped</i></td></tr>
<tr><th id="186">186</th><td>    <b>for</b>(<a class="typedef" href="CascPort.h.html#DWORD" title='DWORD' data-type='unsigned int' data-ref="DWORD" >DWORD</a> <dfn class="local col3 decl" id="23i" title='i' data-type='DWORD' data-ref="23i" >i</dfn> = <var>0</var>; <a class="local col3 ref" href="#23i" title='i' data-ref="23i" >i</a> &lt; <a class="local col1 ref" href="#21pRootBlock" title='pRootBlock' data-ref="21pRootBlock" >pRootBlock</a>-&gt;<a class="tu ref" href="#_CASC_ROOT_BLOCK::pLocaleBlockHdr" title='_CASC_ROOT_BLOCK::pLocaleBlockHdr' data-use='m' data-ref="_CASC_ROOT_BLOCK::pLocaleBlockHdr" >pLocaleBlockHdr</a>-&gt;<a class="tu ref" href="#_FILE_LOCALE_BLOCK::NumberOfFiles" title='_FILE_LOCALE_BLOCK::NumberOfFiles' data-use='r' data-ref="_FILE_LOCALE_BLOCK::NumberOfFiles" >NumberOfFiles</a>; <a class="local col3 ref" href="#23i" title='i' data-ref="23i" >i</a>++)</td></tr>
<tr><th id="187">187</th><td>    {</td></tr>
<tr><th id="188">188</th><td>        <i>// Create new entry, with overflow check</i></td></tr>
<tr><th id="189">189</th><td>        <b>if</b>(<a class="local col0 ref" href="#20pRootHandler" title='pRootHandler' data-ref="20pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::FileTable" title='TRootHandler_WoW6::FileTable' data-use='m' data-ref="TRootHandler_WoW6::FileTable" >FileTable</a>.<a class="ref" href="common/DynamicArray.h.html#_DYNAMIC_ARRAY::ItemCount" title='_DYNAMIC_ARRAY::ItemCount' data-ref="_DYNAMIC_ARRAY::ItemCount" id="_DYNAMIC_ARRAY::ItemCount" >ItemCount</a> &gt;= <a class="local col0 ref" href="#20pRootHandler" title='pRootHandler' data-ref="20pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::FileTable" title='TRootHandler_WoW6::FileTable' data-use='m' data-ref="TRootHandler_WoW6::FileTable" >FileTable</a>.<a class="ref" href="common/DynamicArray.h.html#_DYNAMIC_ARRAY::ItemCountMax" title='_DYNAMIC_ARRAY::ItemCountMax' data-ref="_DYNAMIC_ARRAY::ItemCountMax" id="_DYNAMIC_ARRAY::ItemCountMax" >ItemCountMax</a>)</td></tr>
<tr><th id="190">190</th><td>            <b>return</b> <a class="macro" href="CascPort.h.html#213" title="105" data-ref="_M/ERROR_INSUFFICIENT_BUFFER">ERROR_INSUFFICIENT_BUFFER</a>;</td></tr>
<tr><th id="191">191</th><td>        <a class="local col2 ref" href="#22pFileEntry" title='pFileEntry' data-ref="22pFileEntry" >pFileEntry</a> = (<a class="typedef" href="#PCASC_FILE_ENTRY" title='PCASC_FILE_ENTRY' data-type='struct _CASC_FILE_ENTRY *' data-ref="PCASC_FILE_ENTRY" >PCASC_FILE_ENTRY</a>)<a class="ref" href="common/DynamicArray.h.html#_Z12Array_InsertP14_DYNAMIC_ARRAYPKvm" title='Array_Insert' data-ref="_Z12Array_InsertP14_DYNAMIC_ARRAYPKvm" id="_Z12Array_InsertP14_DYNAMIC_ARRAYPKvm" >Array_Insert</a>(&amp;<a class="local col0 ref" href="#20pRootHandler" title='pRootHandler' data-ref="20pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::FileTable" title='TRootHandler_WoW6::FileTable' data-use='a' data-ref="TRootHandler_WoW6::FileTable" >FileTable</a>, <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>, <var>1</var>);</td></tr>
<tr><th id="192">192</th><td></td></tr>
<tr><th id="193">193</th><td>        <i>// (004147A3) Prepare the CASC_FILE_ENTRY structure</i></td></tr>
<tr><th id="194">194</th><td>        <a class="local col2 ref" href="#22pFileEntry" title='pFileEntry' data-ref="22pFileEntry" >pFileEntry</a>-&gt;<a class="tu ref" href="#_CASC_FILE_ENTRY::FileNameHash" title='_CASC_FILE_ENTRY::FileNameHash' data-use='w' data-ref="_CASC_FILE_ENTRY::FileNameHash" >FileNameHash</a> = <a class="local col1 ref" href="#21pRootBlock" title='pRootBlock' data-ref="21pRootBlock" >pRootBlock</a>-&gt;<a class="tu ref" href="#_CASC_ROOT_BLOCK::pRootEntries" title='_CASC_ROOT_BLOCK::pRootEntries' data-use='m' data-ref="_CASC_ROOT_BLOCK::pRootEntries" >pRootEntries</a>[<a class="local col3 ref" href="#23i" title='i' data-ref="23i" >i</a>].<a class="tu ref" href="#_FILE_ROOT_ENTRY::FileNameHash" title='_FILE_ROOT_ENTRY::FileNameHash' data-use='r' data-ref="_FILE_ROOT_ENTRY::FileNameHash" >FileNameHash</a>;</td></tr>
<tr><th id="195">195</th><td>        <a class="local col2 ref" href="#22pFileEntry" title='pFileEntry' data-ref="22pFileEntry" >pFileEntry</a>-&gt;<a class="tu ref" href="#_CASC_FILE_ENTRY::FileDataId" title='_CASC_FILE_ENTRY::FileDataId' data-use='w' data-ref="_CASC_FILE_ENTRY::FileDataId" >FileDataId</a> = <a class="local col0 ref" href="#20pRootHandler" title='pRootHandler' data-ref="20pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::FileDataId" title='TRootHandler_WoW6::FileDataId' data-use='r' data-ref="TRootHandler_WoW6::FileDataId" >FileDataId</a> + <a class="local col1 ref" href="#21pRootBlock" title='pRootBlock' data-ref="21pRootBlock" >pRootBlock</a>-&gt;<a class="tu ref" href="#_CASC_ROOT_BLOCK::FileDataIds" title='_CASC_ROOT_BLOCK::FileDataIds' data-use='r' data-ref="_CASC_ROOT_BLOCK::FileDataIds" >FileDataIds</a>[<a class="local col3 ref" href="#23i" title='i' data-ref="23i" >i</a>];</td></tr>
<tr><th id="196">196</th><td>        <a class="local col2 ref" href="#22pFileEntry" title='pFileEntry' data-ref="22pFileEntry" >pFileEntry</a>-&gt;<a class="tu ref" href="#_CASC_FILE_ENTRY::Locales" title='_CASC_FILE_ENTRY::Locales' data-use='w' data-ref="_CASC_FILE_ENTRY::Locales" >Locales</a> = <a class="local col1 ref" href="#21pRootBlock" title='pRootBlock' data-ref="21pRootBlock" >pRootBlock</a>-&gt;<a class="tu ref" href="#_CASC_ROOT_BLOCK::pLocaleBlockHdr" title='_CASC_ROOT_BLOCK::pLocaleBlockHdr' data-use='m' data-ref="_CASC_ROOT_BLOCK::pLocaleBlockHdr" >pLocaleBlockHdr</a>-&gt;<a class="tu ref" href="#_FILE_LOCALE_BLOCK::Locales" title='_FILE_LOCALE_BLOCK::Locales' data-use='r' data-ref="_FILE_LOCALE_BLOCK::Locales" >Locales</a>;</td></tr>
<tr><th id="197">197</th><td>        <a class="local col2 ref" href="#22pFileEntry" title='pFileEntry' data-ref="22pFileEntry" >pFileEntry</a>-&gt;<a class="tu ref" href="#_CASC_FILE_ENTRY::EncodingKey" title='_CASC_FILE_ENTRY::EncodingKey' data-use='w' data-ref="_CASC_FILE_ENTRY::EncodingKey" >EncodingKey</a> <a class="ref" href="CascCommon.h.html#_ZN13_ENCODING_KEYaSERKS_" title='_ENCODING_KEY::operator=' data-ref="_ZN13_ENCODING_KEYaSERKS_" id="_ZN13_ENCODING_KEYaSERKS_" >=</a> <a class="local col1 ref" href="#21pRootBlock" title='pRootBlock' data-ref="21pRootBlock" >pRootBlock</a>-&gt;<a class="tu ref" href="#_CASC_ROOT_BLOCK::pRootEntries" title='_CASC_ROOT_BLOCK::pRootEntries' data-use='m' data-ref="_CASC_ROOT_BLOCK::pRootEntries" >pRootEntries</a>[<a class="local col3 ref" href="#23i" title='i' data-ref="23i" >i</a>].<a class="tu ref" href="#_FILE_ROOT_ENTRY::EncodingKey" title='_FILE_ROOT_ENTRY::EncodingKey' data-ref="_FILE_ROOT_ENTRY::EncodingKey" >EncodingKey</a>;</td></tr>
<tr><th id="198">198</th><td></td></tr>
<tr><th id="199">199</th><td>        <i>// Also, insert the entry to the map</i></td></tr>
<tr><th id="200">200</th><td>        <a class="ref" href="common/Map.h.html#_Z16Map_InsertObjectP9_CASC_MAPPvS1_" title='Map_InsertObject' data-ref="_Z16Map_InsertObjectP9_CASC_MAPPvS1_" id="_Z16Map_InsertObjectP9_CASC_MAPPvS1_" >Map_InsertObject</a>(<a class="local col0 ref" href="#20pRootHandler" title='pRootHandler' data-ref="20pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::pRootMap" title='TRootHandler_WoW6::pRootMap' data-use='r' data-ref="TRootHandler_WoW6::pRootMap" >pRootMap</a>, <a class="local col2 ref" href="#22pFileEntry" title='pFileEntry' data-ref="22pFileEntry" >pFileEntry</a>, &amp;<a class="local col2 ref" href="#22pFileEntry" title='pFileEntry' data-ref="22pFileEntry" >pFileEntry</a>-&gt;<a class="tu ref" href="#_CASC_FILE_ENTRY::FileNameHash" title='_CASC_FILE_ENTRY::FileNameHash' data-use='a' data-ref="_CASC_FILE_ENTRY::FileNameHash" >FileNameHash</a>);</td></tr>
<tr><th id="201">201</th><td></td></tr>
<tr><th id="202">202</th><td>        <i>// Update the local File Data Id</i></td></tr>
<tr><th id="203">203</th><td>        <a class="macro" href="../../../../include/assert.h.html#50" title="(static_cast&lt;void&gt; (0))" data-ref="_M/assert">assert</a>((pFileEntry-&gt;FileDataId + <var>1</var>) &gt; pFileEntry-&gt;FileDataId);</td></tr>
<tr><th id="204">204</th><td>        <a class="local col0 ref" href="#20pRootHandler" title='pRootHandler' data-ref="20pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::FileDataId" title='TRootHandler_WoW6::FileDataId' data-use='w' data-ref="TRootHandler_WoW6::FileDataId" >FileDataId</a> = <a class="local col2 ref" href="#22pFileEntry" title='pFileEntry' data-ref="22pFileEntry" >pFileEntry</a>-&gt;<a class="tu ref" href="#_CASC_FILE_ENTRY::FileDataId" title='_CASC_FILE_ENTRY::FileDataId' data-use='r' data-ref="_CASC_FILE_ENTRY::FileDataId" >FileDataId</a> + <var>1</var>;</td></tr>
<tr><th id="205">205</th><td></td></tr>
<tr><th id="206">206</th><td>        <i>// Move to the next root entry</i></td></tr>
<tr><th id="207">207</th><td>        <a class="local col2 ref" href="#22pFileEntry" title='pFileEntry' data-ref="22pFileEntry" >pFileEntry</a>++;</td></tr>
<tr><th id="208">208</th><td>    }</td></tr>
<tr><th id="209">209</th><td></td></tr>
<tr><th id="210">210</th><td>    <b>return</b> <a class="macro" href="CascPort.h.html#204" title="0" data-ref="_M/ERROR_SUCCESS">ERROR_SUCCESS</a>;</td></tr>
<tr><th id="211">211</th><td>}</td></tr>
<tr><th id="212">212</th><td></td></tr>
<tr><th id="213">213</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="_ZL24ParseWowRootFileInternalP17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jbh" title='ParseWowRootFileInternal' data-type='int ParseWowRootFileInternal(TRootHandler_WoW6 * pRootHandler, PARSE_ROOT pfnParseRoot, LPBYTE pbRootFile, LPBYTE pbRootFileEnd, DWORD dwLocaleMask, bool bLoadBlocksWithFlags80, BYTE HighestBitValue)' data-ref="_ZL24ParseWowRootFileInternalP17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jbh" >ParseWowRootFileInternal</dfn>(</td></tr>
<tr><th id="214">214</th><td>    <a class="type" href="#TRootHandler_WoW6" title='TRootHandler_WoW6' data-ref="TRootHandler_WoW6" >TRootHandler_WoW6</a> * <dfn class="local col4 decl" id="24pRootHandler" title='pRootHandler' data-type='TRootHandler_WoW6 *' data-ref="24pRootHandler" >pRootHandler</dfn>,</td></tr>
<tr><th id="215">215</th><td>    <a class="typedef" href="#PARSE_ROOT" title='PARSE_ROOT' data-type='int (*)(TRootHandler_WoW6 *, PCASC_ROOT_BLOCK)' data-ref="PARSE_ROOT" >PARSE_ROOT</a> <dfn class="local col5 decl" id="25pfnParseRoot" title='pfnParseRoot' data-type='PARSE_ROOT' data-ref="25pfnParseRoot" >pfnParseRoot</dfn>,</td></tr>
<tr><th id="216">216</th><td>    <a class="typedef" href="CascPort.h.html#LPBYTE" title='LPBYTE' data-type='BYTE *' data-ref="LPBYTE" >LPBYTE</a> <dfn class="local col6 decl" id="26pbRootFile" title='pbRootFile' data-type='LPBYTE' data-ref="26pbRootFile" >pbRootFile</dfn>,</td></tr>
<tr><th id="217">217</th><td>    <a class="typedef" href="CascPort.h.html#LPBYTE" title='LPBYTE' data-type='BYTE *' data-ref="LPBYTE" >LPBYTE</a> <dfn class="local col7 decl" id="27pbRootFileEnd" title='pbRootFileEnd' data-type='LPBYTE' data-ref="27pbRootFileEnd" >pbRootFileEnd</dfn>,</td></tr>
<tr><th id="218">218</th><td>    <a class="typedef" href="CascPort.h.html#DWORD" title='DWORD' data-type='unsigned int' data-ref="DWORD" >DWORD</a> <dfn class="local col8 decl" id="28dwLocaleMask" title='dwLocaleMask' data-type='DWORD' data-ref="28dwLocaleMask" >dwLocaleMask</dfn>,</td></tr>
<tr><th id="219">219</th><td>    <em>bool</em> <dfn class="local col9 decl" id="29bLoadBlocksWithFlags80" title='bLoadBlocksWithFlags80' data-type='bool' data-ref="29bLoadBlocksWithFlags80" >bLoadBlocksWithFlags80</dfn>,</td></tr>
<tr><th id="220">220</th><td>    <a class="typedef" href="CascPort.h.html#BYTE" title='BYTE' data-type='unsigned char' data-ref="BYTE" >BYTE</a> <dfn class="local col0 decl" id="30HighestBitValue" title='HighestBitValue' data-type='BYTE' data-ref="30HighestBitValue" >HighestBitValue</dfn>)</td></tr>
<tr><th id="221">221</th><td>{</td></tr>
<tr><th id="222">222</th><td>    <a class="typedef" href="#CASC_ROOT_BLOCK" title='CASC_ROOT_BLOCK' data-type='struct _CASC_ROOT_BLOCK' data-ref="CASC_ROOT_BLOCK" >CASC_ROOT_BLOCK</a> <dfn class="local col1 decl" id="31RootBlock" title='RootBlock' data-type='CASC_ROOT_BLOCK' data-ref="31RootBlock" >RootBlock</dfn>;</td></tr>
<tr><th id="223">223</th><td></td></tr>
<tr><th id="224">224</th><td>    <i>// Now parse the root file</i></td></tr>
<tr><th id="225">225</th><td>    <b>while</b>(<a class="local col6 ref" href="#26pbRootFile" title='pbRootFile' data-ref="26pbRootFile" >pbRootFile</a> &lt; <a class="local col7 ref" href="#27pbRootFileEnd" title='pbRootFileEnd' data-ref="27pbRootFileEnd" >pbRootFileEnd</a>)</td></tr>
<tr><th id="226">226</th><td>    {</td></tr>
<tr><th id="227">227</th><td>        <i>// Validate the file locale block</i></td></tr>
<tr><th id="228">228</th><td>        <a class="local col6 ref" href="#26pbRootFile" title='pbRootFile' data-ref="26pbRootFile" >pbRootFile</a> = <a class="ref" href="#_Z17VerifyLocaleBlockP16_CASC_ROOT_BLOCKPhS1_" title='VerifyLocaleBlock' data-ref="_Z17VerifyLocaleBlockP16_CASC_ROOT_BLOCKPhS1_" >VerifyLocaleBlock</a>(&amp;<a class="local col1 ref" href="#31RootBlock" title='RootBlock' data-ref="31RootBlock" >RootBlock</a>, <a class="local col6 ref" href="#26pbRootFile" title='pbRootFile' data-ref="26pbRootFile" >pbRootFile</a>, <a class="local col7 ref" href="#27pbRootFileEnd" title='pbRootFileEnd' data-ref="27pbRootFileEnd" >pbRootFileEnd</a>);</td></tr>
<tr><th id="229">229</th><td>        <b>if</b>(<a class="local col6 ref" href="#26pbRootFile" title='pbRootFile' data-ref="26pbRootFile" >pbRootFile</a> == <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>)</td></tr>
<tr><th id="230">230</th><td>            <b>break</b>;</td></tr>
<tr><th id="231">231</th><td></td></tr>
<tr><th id="232">232</th><td>        <i>// WoW.exe (build 19116): Entries with flag 0x100 set are skipped</i></td></tr>
<tr><th id="233">233</th><td>        <b>if</b>(<a class="local col1 ref" href="#31RootBlock" title='RootBlock' data-ref="31RootBlock" >RootBlock</a>.<a class="tu ref" href="#_CASC_ROOT_BLOCK::pLocaleBlockHdr" title='_CASC_ROOT_BLOCK::pLocaleBlockHdr' data-use='m' data-ref="_CASC_ROOT_BLOCK::pLocaleBlockHdr" >pLocaleBlockHdr</a>-&gt;<a class="tu ref" href="#_FILE_LOCALE_BLOCK::Flags" title='_FILE_LOCALE_BLOCK::Flags' data-use='r' data-ref="_FILE_LOCALE_BLOCK::Flags" >Flags</a> &amp; <var>0x100</var>)</td></tr>
<tr><th id="234">234</th><td>            <b>continue</b>;</td></tr>
<tr><th id="235">235</th><td></td></tr>
<tr><th id="236">236</th><td>        <i>// WoW.exe (build 19116): Entries with flag 0x80 set are skipped if arg_4 is set to FALSE (which is by default)</i></td></tr>
<tr><th id="237">237</th><td>        <b>if</b>((<a class="local col1 ref" href="#31RootBlock" title='RootBlock' data-ref="31RootBlock" >RootBlock</a>.<a class="tu ref" href="#_CASC_ROOT_BLOCK::pLocaleBlockHdr" title='_CASC_ROOT_BLOCK::pLocaleBlockHdr' data-use='m' data-ref="_CASC_ROOT_BLOCK::pLocaleBlockHdr" >pLocaleBlockHdr</a>-&gt;<a class="tu ref" href="#_FILE_LOCALE_BLOCK::Flags" title='_FILE_LOCALE_BLOCK::Flags' data-use='r' data-ref="_FILE_LOCALE_BLOCK::Flags" >Flags</a> &amp; <var>0x80</var>) &amp;&amp; <a class="local col9 ref" href="#29bLoadBlocksWithFlags80" title='bLoadBlocksWithFlags80' data-ref="29bLoadBlocksWithFlags80" >bLoadBlocksWithFlags80</a> == <var>0</var>)</td></tr>
<tr><th id="238">238</th><td>            <b>continue</b>;</td></tr>
<tr><th id="239">239</th><td></td></tr>
<tr><th id="240">240</th><td>        <i>// WoW.exe (build 19116): Entries with (flags &gt;&gt; 0x1F) not equal to arg_8 are skipped</i></td></tr>
<tr><th id="241">241</th><td>        <b>if</b>((<a class="local col1 ref" href="#31RootBlock" title='RootBlock' data-ref="31RootBlock" >RootBlock</a>.<a class="tu ref" href="#_CASC_ROOT_BLOCK::pLocaleBlockHdr" title='_CASC_ROOT_BLOCK::pLocaleBlockHdr' data-use='m' data-ref="_CASC_ROOT_BLOCK::pLocaleBlockHdr" >pLocaleBlockHdr</a>-&gt;<a class="tu ref" href="#_FILE_LOCALE_BLOCK::Flags" title='_FILE_LOCALE_BLOCK::Flags' data-use='r' data-ref="_FILE_LOCALE_BLOCK::Flags" >Flags</a> &gt;&gt; <var>0x1F</var>) != <a class="local col0 ref" href="#30HighestBitValue" title='HighestBitValue' data-ref="30HighestBitValue" >HighestBitValue</a>)</td></tr>
<tr><th id="242">242</th><td>            <b>continue</b>;</td></tr>
<tr><th id="243">243</th><td></td></tr>
<tr><th id="244">244</th><td>        <i>// WoW.exe (build 19116): Locales other than defined mask are skipped too</i></td></tr>
<tr><th id="245">245</th><td>        <b>if</b>((<a class="local col1 ref" href="#31RootBlock" title='RootBlock' data-ref="31RootBlock" >RootBlock</a>.<a class="tu ref" href="#_CASC_ROOT_BLOCK::pLocaleBlockHdr" title='_CASC_ROOT_BLOCK::pLocaleBlockHdr' data-use='m' data-ref="_CASC_ROOT_BLOCK::pLocaleBlockHdr" >pLocaleBlockHdr</a>-&gt;<a class="tu ref" href="#_FILE_LOCALE_BLOCK::Locales" title='_FILE_LOCALE_BLOCK::Locales' data-use='r' data-ref="_FILE_LOCALE_BLOCK::Locales" >Locales</a> &amp; <a class="local col8 ref" href="#28dwLocaleMask" title='dwLocaleMask' data-ref="28dwLocaleMask" >dwLocaleMask</a>) == <var>0</var>)</td></tr>
<tr><th id="246">246</th><td>            <b>continue</b>;</td></tr>
<tr><th id="247">247</th><td></td></tr>
<tr><th id="248">248</th><td>        <i>// Now call the custom function</i></td></tr>
<tr><th id="249">249</th><td>        <a class="local col5 ref" href="#25pfnParseRoot" title='pfnParseRoot' data-ref="25pfnParseRoot" >pfnParseRoot</a>(<a class="local col4 ref" href="#24pRootHandler" title='pRootHandler' data-ref="24pRootHandler" >pRootHandler</a>, &amp;<a class="local col1 ref" href="#31RootBlock" title='RootBlock' data-ref="31RootBlock" >RootBlock</a>);</td></tr>
<tr><th id="250">250</th><td>    }</td></tr>
<tr><th id="251">251</th><td></td></tr>
<tr><th id="252">252</th><td>    <b>return</b> <a class="macro" href="CascPort.h.html#204" title="0" data-ref="_M/ERROR_SUCCESS">ERROR_SUCCESS</a>;</td></tr>
<tr><th id="253">253</th><td>}</td></tr>
<tr><th id="254">254</th><td></td></tr>
<tr><th id="255">255</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh">/*</i></td></tr>
<tr><th id="256">256</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh">    // Code from WoW.exe</i></td></tr>
<tr><th id="257">257</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh">    if(dwLocaleMask == CASC_LOCALE_DUAL_LANG)</i></td></tr>
<tr><th id="258">258</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh">    {</i></td></tr>
<tr><th id="259">259</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh">        // Is this english version of WoW?</i></td></tr>
<tr><th id="260">260</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh">        if(arg_4 == CASC_LOCALE_BIT_ENUS)</i></td></tr>
<tr><th id="261">261</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh">        {</i></td></tr>
<tr><th id="262">262</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh">            LoadWowRootFileLocales(hs, pbRootFile, cbRootFile, CASC_LOCALE_ENGB, false, HighestBitValue);</i></td></tr>
<tr><th id="263">263</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh">            LoadWowRootFileLocales(hs, pbRootFile, cbRootFile, CASC_LOCALE_ENUS, false, HighestBitValue);</i></td></tr>
<tr><th id="264">264</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh">            return ERROR_SUCCESS;</i></td></tr>
<tr><th id="265">265</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh">        }</i></td></tr>
<tr><th id="266">266</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh"></i></td></tr>
<tr><th id="267">267</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh">        // Is this portuguese version of WoW?</i></td></tr>
<tr><th id="268">268</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh">        if(arg_4 == CASC_LOCALE_BIT_PTBR)</i></td></tr>
<tr><th id="269">269</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh">        {</i></td></tr>
<tr><th id="270">270</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh">            LoadWowRootFileLocales(hs, pbRootFile, cbRootFile, CASC_LOCALE_PTPT, false, HighestBitValue);</i></td></tr>
<tr><th id="271">271</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh">            LoadWowRootFileLocales(hs, pbRootFile, cbRootFile, CASC_LOCALE_PTBR, false, HighestBitValue);</i></td></tr>
<tr><th id="272">272</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh">        }</i></td></tr>
<tr><th id="273">273</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh">    }</i></td></tr>
<tr><th id="274">274</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh"></i></td></tr>
<tr><th id="275">275</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh">    LoadWowRootFileLocales(hs, pbRootFile, cbRootFile, (1 &lt;&lt; arg_4), false, HighestBitValue);</i></td></tr>
<tr><th id="276">276</th><td><i  data-doc="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh">*/</i></td></tr>
<tr><th id="277">277</th><td></td></tr>
<tr><th id="278">278</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh" title='ParseWowRootFile2' data-type='int ParseWowRootFile2(TRootHandler_WoW6 * pRootHandler, PARSE_ROOT pfnParseRoot, LPBYTE pbRootFile, LPBYTE pbRootFileEnd, DWORD dwLocaleMask, BYTE HighestBitValue)' data-ref="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh" >ParseWowRootFile2</dfn>(</td></tr>
<tr><th id="279">279</th><td>    <a class="type" href="#TRootHandler_WoW6" title='TRootHandler_WoW6' data-ref="TRootHandler_WoW6" >TRootHandler_WoW6</a> * <dfn class="local col2 decl" id="32pRootHandler" title='pRootHandler' data-type='TRootHandler_WoW6 *' data-ref="32pRootHandler" >pRootHandler</dfn>,</td></tr>
<tr><th id="280">280</th><td>    <a class="typedef" href="#PARSE_ROOT" title='PARSE_ROOT' data-type='int (*)(TRootHandler_WoW6 *, PCASC_ROOT_BLOCK)' data-ref="PARSE_ROOT" >PARSE_ROOT</a> <dfn class="local col3 decl" id="33pfnParseRoot" title='pfnParseRoot' data-type='PARSE_ROOT' data-ref="33pfnParseRoot" >pfnParseRoot</dfn>,</td></tr>
<tr><th id="281">281</th><td>    <a class="typedef" href="CascPort.h.html#LPBYTE" title='LPBYTE' data-type='BYTE *' data-ref="LPBYTE" >LPBYTE</a> <dfn class="local col4 decl" id="34pbRootFile" title='pbRootFile' data-type='LPBYTE' data-ref="34pbRootFile" >pbRootFile</dfn>,</td></tr>
<tr><th id="282">282</th><td>    <a class="typedef" href="CascPort.h.html#LPBYTE" title='LPBYTE' data-type='BYTE *' data-ref="LPBYTE" >LPBYTE</a> <dfn class="local col5 decl" id="35pbRootFileEnd" title='pbRootFileEnd' data-type='LPBYTE' data-ref="35pbRootFileEnd" >pbRootFileEnd</dfn>,</td></tr>
<tr><th id="283">283</th><td>    <a class="typedef" href="CascPort.h.html#DWORD" title='DWORD' data-type='unsigned int' data-ref="DWORD" >DWORD</a> <dfn class="local col6 decl" id="36dwLocaleMask" title='dwLocaleMask' data-type='DWORD' data-ref="36dwLocaleMask" >dwLocaleMask</dfn>,</td></tr>
<tr><th id="284">284</th><td>    <a class="typedef" href="CascPort.h.html#BYTE" title='BYTE' data-type='unsigned char' data-ref="BYTE" >BYTE</a> <dfn class="local col7 decl" id="37HighestBitValue" title='HighestBitValue' data-type='BYTE' data-ref="37HighestBitValue" >HighestBitValue</dfn>)</td></tr>
<tr><th id="285">285</th><td>{</td></tr>
<tr><th id="286">286</th><td>    <i>// Load the locale as-is</i></td></tr>
<tr><th id="287">287</th><td>    <a class="tu ref" href="#_ZL24ParseWowRootFileInternalP17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jbh" title='ParseWowRootFileInternal' data-use='c' data-ref="_ZL24ParseWowRootFileInternalP17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jbh" >ParseWowRootFileInternal</a>(<a class="local col2 ref" href="#32pRootHandler" title='pRootHandler' data-ref="32pRootHandler" >pRootHandler</a>, <a class="local col3 ref" href="#33pfnParseRoot" title='pfnParseRoot' data-ref="33pfnParseRoot" >pfnParseRoot</a>, <a class="local col4 ref" href="#34pbRootFile" title='pbRootFile' data-ref="34pbRootFile" >pbRootFile</a>, <a class="local col5 ref" href="#35pbRootFileEnd" title='pbRootFileEnd' data-ref="35pbRootFileEnd" >pbRootFileEnd</a>, <a class="local col6 ref" href="#36dwLocaleMask" title='dwLocaleMask' data-ref="36dwLocaleMask" >dwLocaleMask</a>, <b>false</b>, <a class="local col7 ref" href="#37HighestBitValue" title='HighestBitValue' data-ref="37HighestBitValue" >HighestBitValue</a>);</td></tr>
<tr><th id="288">288</th><td></td></tr>
<tr><th id="289">289</th><td>    <i>// If we wanted enGB, we also load enUS for the missing files</i></td></tr>
<tr><th id="290">290</th><td>    <b>if</b>(<a class="local col6 ref" href="#36dwLocaleMask" title='dwLocaleMask' data-ref="36dwLocaleMask" >dwLocaleMask</a> == <a class="macro" href="CascLib.h.html#75" title="0x00000200" data-ref="_M/CASC_LOCALE_ENGB">CASC_LOCALE_ENGB</a>)</td></tr>
<tr><th id="291">291</th><td>        <a class="tu ref" href="#_ZL24ParseWowRootFileInternalP17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jbh" title='ParseWowRootFileInternal' data-use='c' data-ref="_ZL24ParseWowRootFileInternalP17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jbh" >ParseWowRootFileInternal</a>(<a class="local col2 ref" href="#32pRootHandler" title='pRootHandler' data-ref="32pRootHandler" >pRootHandler</a>, <a class="local col3 ref" href="#33pfnParseRoot" title='pfnParseRoot' data-ref="33pfnParseRoot" >pfnParseRoot</a>, <a class="local col4 ref" href="#34pbRootFile" title='pbRootFile' data-ref="34pbRootFile" >pbRootFile</a>, <a class="local col5 ref" href="#35pbRootFileEnd" title='pbRootFileEnd' data-ref="35pbRootFileEnd" >pbRootFileEnd</a>, <a class="macro" href="CascLib.h.html#67" title="0x00000002" data-ref="_M/CASC_LOCALE_ENUS">CASC_LOCALE_ENUS</a>, <b>false</b>, <a class="local col7 ref" href="#37HighestBitValue" title='HighestBitValue' data-ref="37HighestBitValue" >HighestBitValue</a>);</td></tr>
<tr><th id="292">292</th><td></td></tr>
<tr><th id="293">293</th><td>    <b>if</b>(<a class="local col6 ref" href="#36dwLocaleMask" title='dwLocaleMask' data-ref="36dwLocaleMask" >dwLocaleMask</a> == <a class="macro" href="CascLib.h.html#82" title="0x00010000" data-ref="_M/CASC_LOCALE_PTPT">CASC_LOCALE_PTPT</a>)</td></tr>
<tr><th id="294">294</th><td>        <a class="tu ref" href="#_ZL24ParseWowRootFileInternalP17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jbh" title='ParseWowRootFileInternal' data-use='c' data-ref="_ZL24ParseWowRootFileInternalP17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jbh" >ParseWowRootFileInternal</a>(<a class="local col2 ref" href="#32pRootHandler" title='pRootHandler' data-ref="32pRootHandler" >pRootHandler</a>, <a class="local col3 ref" href="#33pfnParseRoot" title='pfnParseRoot' data-ref="33pfnParseRoot" >pfnParseRoot</a>, <a class="local col4 ref" href="#34pbRootFile" title='pbRootFile' data-ref="34pbRootFile" >pbRootFile</a>, <a class="local col5 ref" href="#35pbRootFileEnd" title='pbRootFileEnd' data-ref="35pbRootFileEnd" >pbRootFileEnd</a>, <a class="macro" href="CascLib.h.html#80" title="0x00004000" data-ref="_M/CASC_LOCALE_PTBR">CASC_LOCALE_PTBR</a>, <b>false</b>, <a class="local col7 ref" href="#37HighestBitValue" title='HighestBitValue' data-ref="37HighestBitValue" >HighestBitValue</a>);</td></tr>
<tr><th id="295">295</th><td></td></tr>
<tr><th id="296">296</th><td>    <b>return</b> <a class="macro" href="CascPort.h.html#204" title="0" data-ref="_M/ERROR_SUCCESS">ERROR_SUCCESS</a>;</td></tr>
<tr><th id="297">297</th><td>}</td></tr>
<tr><th id="298">298</th><td></td></tr>
<tr><th id="299">299</th><td><i  data-doc="_ZL16ParseWowRootFileP17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_j">// WoW.exe: 004146C7 (BuildManifest::Load)</i></td></tr>
<tr><th id="300">300</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="_ZL16ParseWowRootFileP17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_j" title='ParseWowRootFile' data-type='int ParseWowRootFile(TRootHandler_WoW6 * pRootHandler, PARSE_ROOT pfnParseRoot, LPBYTE pbRootFile, LPBYTE pbRootFileEnd, DWORD dwLocaleMask)' data-ref="_ZL16ParseWowRootFileP17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_j" >ParseWowRootFile</dfn>(</td></tr>
<tr><th id="301">301</th><td>    <a class="type" href="#TRootHandler_WoW6" title='TRootHandler_WoW6' data-ref="TRootHandler_WoW6" >TRootHandler_WoW6</a> * <dfn class="local col8 decl" id="38pRootHandler" title='pRootHandler' data-type='TRootHandler_WoW6 *' data-ref="38pRootHandler" >pRootHandler</dfn>,</td></tr>
<tr><th id="302">302</th><td>    <a class="typedef" href="#PARSE_ROOT" title='PARSE_ROOT' data-type='int (*)(TRootHandler_WoW6 *, PCASC_ROOT_BLOCK)' data-ref="PARSE_ROOT" >PARSE_ROOT</a> <dfn class="local col9 decl" id="39pfnParseRoot" title='pfnParseRoot' data-type='PARSE_ROOT' data-ref="39pfnParseRoot" >pfnParseRoot</dfn>,</td></tr>
<tr><th id="303">303</th><td>    <a class="typedef" href="CascPort.h.html#LPBYTE" title='LPBYTE' data-type='BYTE *' data-ref="LPBYTE" >LPBYTE</a> <dfn class="local col0 decl" id="40pbRootFile" title='pbRootFile' data-type='LPBYTE' data-ref="40pbRootFile" >pbRootFile</dfn>,</td></tr>
<tr><th id="304">304</th><td>    <a class="typedef" href="CascPort.h.html#LPBYTE" title='LPBYTE' data-type='BYTE *' data-ref="LPBYTE" >LPBYTE</a> <dfn class="local col1 decl" id="41pbRootFileEnd" title='pbRootFileEnd' data-type='LPBYTE' data-ref="41pbRootFileEnd" >pbRootFileEnd</dfn>,</td></tr>
<tr><th id="305">305</th><td>    <a class="typedef" href="CascPort.h.html#DWORD" title='DWORD' data-type='unsigned int' data-ref="DWORD" >DWORD</a> <dfn class="local col2 decl" id="42dwLocaleMask" title='dwLocaleMask' data-type='DWORD' data-ref="42dwLocaleMask" >dwLocaleMask</dfn>)</td></tr>
<tr><th id="306">306</th><td>{</td></tr>
<tr><th id="307">307</th><td>    <a class="tu ref" href="#_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh" title='ParseWowRootFile2' data-use='c' data-ref="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh" >ParseWowRootFile2</a>(<a class="local col8 ref" href="#38pRootHandler" title='pRootHandler' data-ref="38pRootHandler" >pRootHandler</a>, <a class="local col9 ref" href="#39pfnParseRoot" title='pfnParseRoot' data-ref="39pfnParseRoot" >pfnParseRoot</a>, <a class="local col0 ref" href="#40pbRootFile" title='pbRootFile' data-ref="40pbRootFile" >pbRootFile</a>, <a class="local col1 ref" href="#41pbRootFileEnd" title='pbRootFileEnd' data-ref="41pbRootFileEnd" >pbRootFileEnd</a>, <a class="local col2 ref" href="#42dwLocaleMask" title='dwLocaleMask' data-ref="42dwLocaleMask" >dwLocaleMask</a>, <var>0</var>);</td></tr>
<tr><th id="308">308</th><td>    <a class="tu ref" href="#_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh" title='ParseWowRootFile2' data-use='c' data-ref="_ZL17ParseWowRootFile2P17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_jh" >ParseWowRootFile2</a>(<a class="local col8 ref" href="#38pRootHandler" title='pRootHandler' data-ref="38pRootHandler" >pRootHandler</a>, <a class="local col9 ref" href="#39pfnParseRoot" title='pfnParseRoot' data-ref="39pfnParseRoot" >pfnParseRoot</a>, <a class="local col0 ref" href="#40pbRootFile" title='pbRootFile' data-ref="40pbRootFile" >pbRootFile</a>, <a class="local col1 ref" href="#41pbRootFileEnd" title='pbRootFileEnd' data-ref="41pbRootFileEnd" >pbRootFileEnd</a>, <a class="local col2 ref" href="#42dwLocaleMask" title='dwLocaleMask' data-ref="42dwLocaleMask" >dwLocaleMask</a>, <var>1</var>);</td></tr>
<tr><th id="309">309</th><td>    <b>return</b> <a class="macro" href="CascPort.h.html#204" title="0" data-ref="_M/ERROR_SUCCESS">ERROR_SUCCESS</a>;</td></tr>
<tr><th id="310">310</th><td>}</td></tr>
<tr><th id="311">311</th><td></td></tr>
<tr><th id="312">312</th><td><i  data-doc="_ZL17WowHandler_InsertP17TRootHandler_WoW6PKcPh">//-----------------------------------------------------------------------------</i></td></tr>
<tr><th id="313">313</th><td><i  data-doc="_ZL17WowHandler_InsertP17TRootHandler_WoW6PKcPh">// Implementation of WoW6 root file</i></td></tr>
<tr><th id="314">314</th><td></td></tr>
<tr><th id="315">315</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="_ZL17WowHandler_InsertP17TRootHandler_WoW6PKcPh" title='WowHandler_Insert' data-type='int WowHandler_Insert(TRootHandler_WoW6 * pRootHandler, const char * szFileName, LPBYTE pbEncodingKey)' data-ref="_ZL17WowHandler_InsertP17TRootHandler_WoW6PKcPh" >WowHandler_Insert</dfn>(</td></tr>
<tr><th id="316">316</th><td>    <a class="type" href="#TRootHandler_WoW6" title='TRootHandler_WoW6' data-ref="TRootHandler_WoW6" >TRootHandler_WoW6</a> * <dfn class="local col3 decl" id="43pRootHandler" title='pRootHandler' data-type='TRootHandler_WoW6 *' data-ref="43pRootHandler" >pRootHandler</dfn>, </td></tr>
<tr><th id="317">317</th><td>    <em>const</em> <em>char</em> * <dfn class="local col4 decl" id="44szFileName" title='szFileName' data-type='const char *' data-ref="44szFileName" >szFileName</dfn>,</td></tr>
<tr><th id="318">318</th><td>    <a class="typedef" href="CascPort.h.html#LPBYTE" title='LPBYTE' data-type='BYTE *' data-ref="LPBYTE" >LPBYTE</a> <dfn class="local col5 decl" id="45pbEncodingKey" title='pbEncodingKey' data-type='LPBYTE' data-ref="45pbEncodingKey" >pbEncodingKey</dfn>)</td></tr>
<tr><th id="319">319</th><td>{</td></tr>
<tr><th id="320">320</th><td>    <a class="typedef" href="#PCASC_FILE_ENTRY" title='PCASC_FILE_ENTRY' data-type='struct _CASC_FILE_ENTRY *' data-ref="PCASC_FILE_ENTRY" >PCASC_FILE_ENTRY</a> <dfn class="local col6 decl" id="46pFileEntry" title='pFileEntry' data-type='PCASC_FILE_ENTRY' data-ref="46pFileEntry" >pFileEntry</dfn>;</td></tr>
<tr><th id="321">321</th><td>    <a class="typedef" href="CascPort.h.html#DWORD" title='DWORD' data-type='unsigned int' data-ref="DWORD" >DWORD</a> <dfn class="local col7 decl" id="47FileDataId" title='FileDataId' data-type='DWORD' data-ref="47FileDataId" >FileDataId</dfn> = <var>0</var>;</td></tr>
<tr><th id="322">322</th><td></td></tr>
<tr><th id="323">323</th><td>    <i>// Don't let the number of items to overflow</i></td></tr>
<tr><th id="324">324</th><td>    <b>if</b>(<a class="local col3 ref" href="#43pRootHandler" title='pRootHandler' data-ref="43pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::FileTable" title='TRootHandler_WoW6::FileTable' data-use='m' data-ref="TRootHandler_WoW6::FileTable" >FileTable</a>.<a class="ref" href="common/DynamicArray.h.html#_DYNAMIC_ARRAY::ItemCount" title='_DYNAMIC_ARRAY::ItemCount' data-ref="_DYNAMIC_ARRAY::ItemCount" id="_DYNAMIC_ARRAY::ItemCount" >ItemCount</a> &gt;= <a class="local col3 ref" href="#43pRootHandler" title='pRootHandler' data-ref="43pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::FileTable" title='TRootHandler_WoW6::FileTable' data-use='m' data-ref="TRootHandler_WoW6::FileTable" >FileTable</a>.<a class="ref" href="common/DynamicArray.h.html#_DYNAMIC_ARRAY::ItemCountMax" title='_DYNAMIC_ARRAY::ItemCountMax' data-ref="_DYNAMIC_ARRAY::ItemCountMax" id="_DYNAMIC_ARRAY::ItemCountMax" >ItemCountMax</a>)</td></tr>
<tr><th id="325">325</th><td>        <b>return</b> <a class="macro" href="CascPort.h.html#208" title="12" data-ref="_M/ERROR_NOT_ENOUGH_MEMORY">ERROR_NOT_ENOUGH_MEMORY</a>;</td></tr>
<tr><th id="326">326</th><td></td></tr>
<tr><th id="327">327</th><td>    <i>// Insert the item to the linear file list</i></td></tr>
<tr><th id="328">328</th><td>    <a class="local col6 ref" href="#46pFileEntry" title='pFileEntry' data-ref="46pFileEntry" >pFileEntry</a> = (<a class="typedef" href="#PCASC_FILE_ENTRY" title='PCASC_FILE_ENTRY' data-type='struct _CASC_FILE_ENTRY *' data-ref="PCASC_FILE_ENTRY" >PCASC_FILE_ENTRY</a>)<a class="ref" href="common/DynamicArray.h.html#_Z12Array_InsertP14_DYNAMIC_ARRAYPKvm" title='Array_Insert' data-ref="_Z12Array_InsertP14_DYNAMIC_ARRAYPKvm" id="_Z12Array_InsertP14_DYNAMIC_ARRAYPKvm" >Array_Insert</a>(&amp;<a class="local col3 ref" href="#43pRootHandler" title='pRootHandler' data-ref="43pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::FileTable" title='TRootHandler_WoW6::FileTable' data-use='a' data-ref="TRootHandler_WoW6::FileTable" >FileTable</a>, <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>, <var>1</var>);</td></tr>
<tr><th id="329">329</th><td>    <b>if</b>(<a class="local col6 ref" href="#46pFileEntry" title='pFileEntry' data-ref="46pFileEntry" >pFileEntry</a> != <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>)</td></tr>
<tr><th id="330">330</th><td>    {</td></tr>
<tr><th id="331">331</th><td>        <i>// Get the file data ID of the previous item (0 if this is the first one)</i></td></tr>
<tr><th id="332">332</th><td>        <b>if</b>(<a class="local col3 ref" href="#43pRootHandler" title='pRootHandler' data-ref="43pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::FileTable" title='TRootHandler_WoW6::FileTable' data-use='m' data-ref="TRootHandler_WoW6::FileTable" >FileTable</a>.<a class="ref" href="common/DynamicArray.h.html#_DYNAMIC_ARRAY::ItemCount" title='_DYNAMIC_ARRAY::ItemCount' data-ref="_DYNAMIC_ARRAY::ItemCount" id="_DYNAMIC_ARRAY::ItemCount" >ItemCount</a> &gt; <var>1</var>)</td></tr>
<tr><th id="333">333</th><td>            <a class="local col7 ref" href="#47FileDataId" title='FileDataId' data-ref="47FileDataId" >FileDataId</a> = <a class="local col6 ref" href="#46pFileEntry" title='pFileEntry' data-ref="46pFileEntry" >pFileEntry</a>[-<var>1</var>].<a class="tu ref" href="#_CASC_FILE_ENTRY::FileDataId" title='_CASC_FILE_ENTRY::FileDataId' data-use='r' data-ref="_CASC_FILE_ENTRY::FileDataId" >FileDataId</a>;</td></tr>
<tr><th id="334">334</th><td></td></tr>
<tr><th id="335">335</th><td>        <i>// Fill-in the new entry</i></td></tr>
<tr><th id="336">336</th><td>        <a class="local col6 ref" href="#46pFileEntry" title='pFileEntry' data-ref="46pFileEntry" >pFileEntry</a>-&gt;<a class="tu ref" href="#_CASC_FILE_ENTRY::EncodingKey" title='_CASC_FILE_ENTRY::EncodingKey' data-use='w' data-ref="_CASC_FILE_ENTRY::EncodingKey" >EncodingKey</a>  <a class="ref" href="CascCommon.h.html#_ZN13_ENCODING_KEYaSERKS_" title='_ENCODING_KEY::operator=' data-ref="_ZN13_ENCODING_KEYaSERKS_" id="_ZN13_ENCODING_KEYaSERKS_" >=</a> *(<a class="typedef" href="CascCommon.h.html#PENCODING_KEY" title='PENCODING_KEY' data-type='struct _ENCODING_KEY *' data-ref="PENCODING_KEY" >PENCODING_KEY</a>)<a class="local col5 ref" href="#45pbEncodingKey" title='pbEncodingKey' data-ref="45pbEncodingKey" >pbEncodingKey</a>;</td></tr>
<tr><th id="337">337</th><td>        <a class="local col6 ref" href="#46pFileEntry" title='pFileEntry' data-ref="46pFileEntry" >pFileEntry</a>-&gt;<a class="tu ref" href="#_CASC_FILE_ENTRY::FileNameHash" title='_CASC_FILE_ENTRY::FileNameHash' data-use='w' data-ref="_CASC_FILE_ENTRY::FileNameHash" >FileNameHash</a> = <a class="ref" href="common/Common.h.html#_Z16CalcFileNameHashPKc" title='CalcFileNameHash' data-ref="_Z16CalcFileNameHashPKc" id="_Z16CalcFileNameHashPKc" >CalcFileNameHash</a>(<a class="local col4 ref" href="#44szFileName" title='szFileName' data-ref="44szFileName" >szFileName</a>);</td></tr>
<tr><th id="338">338</th><td>        <a class="local col6 ref" href="#46pFileEntry" title='pFileEntry' data-ref="46pFileEntry" >pFileEntry</a>-&gt;<a class="tu ref" href="#_CASC_FILE_ENTRY::FileDataId" title='_CASC_FILE_ENTRY::FileDataId' data-use='w' data-ref="_CASC_FILE_ENTRY::FileDataId" >FileDataId</a>   = <a class="local col7 ref" href="#47FileDataId" title='FileDataId' data-ref="47FileDataId" >FileDataId</a> + <var>1</var>;</td></tr>
<tr><th id="339">339</th><td>        <a class="local col6 ref" href="#46pFileEntry" title='pFileEntry' data-ref="46pFileEntry" >pFileEntry</a>-&gt;<a class="tu ref" href="#_CASC_FILE_ENTRY::Locales" title='_CASC_FILE_ENTRY::Locales' data-use='w' data-ref="_CASC_FILE_ENTRY::Locales" >Locales</a>      = <a class="macro" href="CascLib.h.html#64" title="0xFFFFFFFF" data-ref="_M/CASC_LOCALE_ALL">CASC_LOCALE_ALL</a>;</td></tr>
<tr><th id="340">340</th><td></td></tr>
<tr><th id="341">341</th><td>        <i>// Verify collisions (debug version only)</i></td></tr>
<tr><th id="342">342</th><td>        <a class="macro" href="../../../../include/assert.h.html#50" title="(static_cast&lt;void&gt; (0))" data-ref="_M/assert">assert</a>(Map_FindObject(pRootHandler-&gt;pRootMap, &amp;pFileEntry-&gt;FileNameHash, NULL) == NULL);</td></tr>
<tr><th id="343">343</th><td></td></tr>
<tr><th id="344">344</th><td>        <i>// Insert the entry to the map</i></td></tr>
<tr><th id="345">345</th><td>        <a class="ref" href="common/Map.h.html#_Z16Map_InsertObjectP9_CASC_MAPPvS1_" title='Map_InsertObject' data-ref="_Z16Map_InsertObjectP9_CASC_MAPPvS1_" id="_Z16Map_InsertObjectP9_CASC_MAPPvS1_" >Map_InsertObject</a>(<a class="local col3 ref" href="#43pRootHandler" title='pRootHandler' data-ref="43pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::pRootMap" title='TRootHandler_WoW6::pRootMap' data-use='r' data-ref="TRootHandler_WoW6::pRootMap" >pRootMap</a>, <a class="local col6 ref" href="#46pFileEntry" title='pFileEntry' data-ref="46pFileEntry" >pFileEntry</a>, &amp;<a class="local col6 ref" href="#46pFileEntry" title='pFileEntry' data-ref="46pFileEntry" >pFileEntry</a>-&gt;<a class="tu ref" href="#_CASC_FILE_ENTRY::FileNameHash" title='_CASC_FILE_ENTRY::FileNameHash' data-use='a' data-ref="_CASC_FILE_ENTRY::FileNameHash" >FileNameHash</a>);</td></tr>
<tr><th id="346">346</th><td>    }</td></tr>
<tr><th id="347">347</th><td></td></tr>
<tr><th id="348">348</th><td>    <b>return</b> <a class="macro" href="CascPort.h.html#204" title="0" data-ref="_M/ERROR_SUCCESS">ERROR_SUCCESS</a>;</td></tr>
<tr><th id="349">349</th><td>}</td></tr>
<tr><th id="350">350</th><td></td></tr>
<tr><th id="351">351</th><td><em>static</em> <a class="typedef" href="CascPort.h.html#LPBYTE" title='LPBYTE' data-type='BYTE *' data-ref="LPBYTE" >LPBYTE</a> <dfn class="tu decl def" id="_ZL17WowHandler_SearchP17TRootHandler_WoW6P12_TCascSearchPjS3_" title='WowHandler_Search' data-type='LPBYTE WowHandler_Search(TRootHandler_WoW6 * pRootHandler, TCascSearch * pSearch, PDWORD , PDWORD PtrLocaleFlags)' data-ref="_ZL17WowHandler_SearchP17TRootHandler_WoW6P12_TCascSearchPjS3_" >WowHandler_Search</dfn>(<a class="type" href="#TRootHandler_WoW6" title='TRootHandler_WoW6' data-ref="TRootHandler_WoW6" >TRootHandler_WoW6</a> * <dfn class="local col8 decl" id="48pRootHandler" title='pRootHandler' data-type='TRootHandler_WoW6 *' data-ref="48pRootHandler" >pRootHandler</dfn>, <a class="typedef" href="CascCommon.h.html#TCascSearch" title='TCascSearch' data-type='struct _TCascSearch' data-ref="TCascSearch" >TCascSearch</a> * <dfn class="local col9 decl" id="49pSearch" title='pSearch' data-type='TCascSearch *' data-ref="49pSearch" >pSearch</dfn>, <a class="typedef" href="CascPort.h.html#PDWORD" title='PDWORD' data-type='DWORD *' data-ref="PDWORD" >PDWORD</a> <i  data-doc="_ZL17WowHandler_SearchP17TRootHandler_WoW6P12_TCascSearchPjS3_">/* PtrFileSize */</i>, <a class="typedef" href="CascPort.h.html#PDWORD" title='PDWORD' data-type='DWORD *' data-ref="PDWORD" >PDWORD</a> <dfn class="local col0 decl" id="50PtrLocaleFlags" title='PtrLocaleFlags' data-type='PDWORD' data-ref="50PtrLocaleFlags" >PtrLocaleFlags</dfn>)</td></tr>
<tr><th id="352">352</th><td>{</td></tr>
<tr><th id="353">353</th><td>    <a class="typedef" href="#PCASC_FILE_ENTRY" title='PCASC_FILE_ENTRY' data-type='struct _CASC_FILE_ENTRY *' data-ref="PCASC_FILE_ENTRY" >PCASC_FILE_ENTRY</a> <dfn class="local col1 decl" id="51pFileEntry" title='pFileEntry' data-type='PCASC_FILE_ENTRY' data-ref="51pFileEntry" >pFileEntry</dfn>;</td></tr>
<tr><th id="354">354</th><td></td></tr>
<tr><th id="355">355</th><td>    <i>// Only if we have a listfile</i></td></tr>
<tr><th id="356">356</th><td>    <b>if</b>(<a class="local col9 ref" href="#49pSearch" title='pSearch' data-ref="49pSearch" >pSearch</a>-&gt;<a class="ref" href="CascCommon.h.html#_TCascSearch::pCache" title='_TCascSearch::pCache' data-ref="_TCascSearch::pCache" id="_TCascSearch::pCache" >pCache</a> != <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>)</td></tr>
<tr><th id="357">357</th><td>    {</td></tr>
<tr><th id="358">358</th><td>        <i>// Keep going through the listfile</i></td></tr>
<tr><th id="359">359</th><td>        <b>while</b>(<a class="ref" href="common/ListFile.h.html#_Z16ListFile_GetNextPvPKcPcm" title='ListFile_GetNext' data-ref="_Z16ListFile_GetNextPvPKcPcm" id="_Z16ListFile_GetNextPvPKcPcm" >ListFile_GetNext</a>(<a class="local col9 ref" href="#49pSearch" title='pSearch' data-ref="49pSearch" >pSearch</a>-&gt;<a class="ref" href="CascCommon.h.html#_TCascSearch::pCache" title='_TCascSearch::pCache' data-ref="_TCascSearch::pCache" id="_TCascSearch::pCache" >pCache</a>, <a class="local col9 ref" href="#49pSearch" title='pSearch' data-ref="49pSearch" >pSearch</a>-&gt;<a class="ref" href="CascCommon.h.html#_TCascSearch::szMask" title='_TCascSearch::szMask' data-ref="_TCascSearch::szMask" id="_TCascSearch::szMask" >szMask</a>, <a class="local col9 ref" href="#49pSearch" title='pSearch' data-ref="49pSearch" >pSearch</a>-&gt;<a class="ref" href="CascCommon.h.html#_TCascSearch::szFileName" title='_TCascSearch::szFileName' data-ref="_TCascSearch::szFileName" id="_TCascSearch::szFileName" >szFileName</a>, <a class="macro" href="CascPort.h.html#160" title="1024" data-ref="_M/MAX_PATH">MAX_PATH</a>))</td></tr>
<tr><th id="360">360</th><td>        {</td></tr>
<tr><th id="361">361</th><td>            <i>// Find the root entry</i></td></tr>
<tr><th id="362">362</th><td>            <a class="local col1 ref" href="#51pFileEntry" title='pFileEntry' data-ref="51pFileEntry" >pFileEntry</a> = <a class="ref" href="#_Z13FindRootEntryP9_CASC_MAPPKcPj" title='FindRootEntry' data-ref="_Z13FindRootEntryP9_CASC_MAPPKcPj" >FindRootEntry</a>(<a class="local col8 ref" href="#48pRootHandler" title='pRootHandler' data-ref="48pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::pRootMap" title='TRootHandler_WoW6::pRootMap' data-use='r' data-ref="TRootHandler_WoW6::pRootMap" >pRootMap</a>, <a class="local col9 ref" href="#49pSearch" title='pSearch' data-ref="49pSearch" >pSearch</a>-&gt;<a class="ref" href="CascCommon.h.html#_TCascSearch::szFileName" title='_TCascSearch::szFileName' data-ref="_TCascSearch::szFileName" id="_TCascSearch::szFileName" >szFileName</a>, <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="363">363</th><td>            <b>if</b>(<a class="local col1 ref" href="#51pFileEntry" title='pFileEntry' data-ref="51pFileEntry" >pFileEntry</a> != <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>)</td></tr>
<tr><th id="364">364</th><td>            {</td></tr>
<tr><th id="365">365</th><td>                <i>// Give the caller the locale mask</i></td></tr>
<tr><th id="366">366</th><td>                <b>if</b>(<a class="local col0 ref" href="#50PtrLocaleFlags" title='PtrLocaleFlags' data-ref="50PtrLocaleFlags" >PtrLocaleFlags</a> != <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>)</td></tr>
<tr><th id="367">367</th><td>                    <a class="local col0 ref" href="#50PtrLocaleFlags" title='PtrLocaleFlags' data-ref="50PtrLocaleFlags" >PtrLocaleFlags</a>[<var>0</var>] = <a class="local col1 ref" href="#51pFileEntry" title='pFileEntry' data-ref="51pFileEntry" >pFileEntry</a>-&gt;<a class="tu ref" href="#_CASC_FILE_ENTRY::Locales" title='_CASC_FILE_ENTRY::Locales' data-use='r' data-ref="_CASC_FILE_ENTRY::Locales" >Locales</a>;</td></tr>
<tr><th id="368">368</th><td>                <b>return</b> <a class="local col1 ref" href="#51pFileEntry" title='pFileEntry' data-ref="51pFileEntry" >pFileEntry</a>-&gt;<a class="tu ref" href="#_CASC_FILE_ENTRY::EncodingKey" title='_CASC_FILE_ENTRY::EncodingKey' data-use='m' data-ref="_CASC_FILE_ENTRY::EncodingKey" >EncodingKey</a>.<a class="ref" href="CascCommon.h.html#_ENCODING_KEY::Value" title='_ENCODING_KEY::Value' data-ref="_ENCODING_KEY::Value" id="_ENCODING_KEY::Value" >Value</a>;</td></tr>
<tr><th id="369">369</th><td>            }</td></tr>
<tr><th id="370">370</th><td>        }</td></tr>
<tr><th id="371">371</th><td>    }</td></tr>
<tr><th id="372">372</th><td></td></tr>
<tr><th id="373">373</th><td>    <i>// No more files</i></td></tr>
<tr><th id="374">374</th><td>    <b>return</b> <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="375">375</th><td>}</td></tr>
<tr><th id="376">376</th><td></td></tr>
<tr><th id="377">377</th><td><em>static</em> <a class="typedef" href="CascPort.h.html#LPBYTE" title='LPBYTE' data-type='BYTE *' data-ref="LPBYTE" >LPBYTE</a> <dfn class="tu decl def" id="_ZL17WowHandler_GetKeyP17TRootHandler_WoW6PKc" title='WowHandler_GetKey' data-type='LPBYTE WowHandler_GetKey(TRootHandler_WoW6 * pRootHandler, const char * szFileName)' data-ref="_ZL17WowHandler_GetKeyP17TRootHandler_WoW6PKc" >WowHandler_GetKey</dfn>(<a class="type" href="#TRootHandler_WoW6" title='TRootHandler_WoW6' data-ref="TRootHandler_WoW6" >TRootHandler_WoW6</a> * <dfn class="local col2 decl" id="52pRootHandler" title='pRootHandler' data-type='TRootHandler_WoW6 *' data-ref="52pRootHandler" >pRootHandler</dfn>, <em>const</em> <em>char</em> * <dfn class="local col3 decl" id="53szFileName" title='szFileName' data-type='const char *' data-ref="53szFileName" >szFileName</dfn>)</td></tr>
<tr><th id="378">378</th><td>{</td></tr>
<tr><th id="379">379</th><td>    <a class="typedef" href="#PCASC_FILE_ENTRY" title='PCASC_FILE_ENTRY' data-type='struct _CASC_FILE_ENTRY *' data-ref="PCASC_FILE_ENTRY" >PCASC_FILE_ENTRY</a> <dfn class="local col4 decl" id="54pFileEntry" title='pFileEntry' data-type='PCASC_FILE_ENTRY' data-ref="54pFileEntry" >pFileEntry</dfn>;</td></tr>
<tr><th id="380">380</th><td>    <a class="typedef" href="CascPort.h.html#DWORD" title='DWORD' data-type='unsigned int' data-ref="DWORD" >DWORD</a> <dfn class="local col5 decl" id="55FileDataId" title='FileDataId' data-type='DWORD' data-ref="55FileDataId" >FileDataId</dfn>;</td></tr>
<tr><th id="381">381</th><td>    <a class="typedef" href="CascPort.h.html#BYTE" title='BYTE' data-type='unsigned char' data-ref="BYTE" >BYTE</a> <dfn class="local col6 decl" id="56FileDataIdLE" title='FileDataIdLE' data-type='BYTE [4]' data-ref="56FileDataIdLE" >FileDataIdLE</dfn>[<var>4</var>];</td></tr>
<tr><th id="382">382</th><td></td></tr>
<tr><th id="383">383</th><td>    <i>// Open by FileDataId. The file name must be as following:</i></td></tr>
<tr><th id="384">384</th><td><i>    // File########.xxx, where '#' are hexa-decimal numbers (case insensitive).</i></td></tr>
<tr><th id="385">385</th><td><i>    // Extension is ignored in that case</i></td></tr>
<tr><th id="386">386</th><td>    <b>if</b>(<a class="tu ref" href="#_ZL16IsFileDataIdNamePKc" title='IsFileDataIdName' data-use='c' data-ref="_ZL16IsFileDataIdNamePKc" >IsFileDataIdName</a>(<a class="local col3 ref" href="#53szFileName" title='szFileName' data-ref="53szFileName" >szFileName</a>))</td></tr>
<tr><th id="387">387</th><td>    {</td></tr>
<tr><th id="388">388</th><td>        <a class="ref" href="common/Common.h.html#_Z21ConvertStringToBinaryPKcmPh" title='ConvertStringToBinary' data-ref="_Z21ConvertStringToBinaryPKcmPh" id="_Z21ConvertStringToBinaryPKcmPh" >ConvertStringToBinary</a>(<a class="local col3 ref" href="#53szFileName" title='szFileName' data-ref="53szFileName" >szFileName</a> + <var>4</var>, <var>8</var>, <a class="local col6 ref" href="#56FileDataIdLE" title='FileDataIdLE' data-ref="56FileDataIdLE" >FileDataIdLE</a>);</td></tr>
<tr><th id="389">389</th><td>        <a class="local col5 ref" href="#55FileDataId" title='FileDataId' data-ref="55FileDataId" >FileDataId</a> = <a class="ref" href="CascCommon.h.html#_Z23ConvertBytesToInteger_4Ph" title='ConvertBytesToInteger_4' data-ref="_Z23ConvertBytesToInteger_4Ph" id="_Z23ConvertBytesToInteger_4Ph" >ConvertBytesToInteger_4</a>(<a class="local col6 ref" href="#56FileDataIdLE" title='FileDataIdLE' data-ref="56FileDataIdLE" >FileDataIdLE</a>);</td></tr>
<tr><th id="390">390</th><td></td></tr>
<tr><th id="391">391</th><td>        <a class="local col4 ref" href="#54pFileEntry" title='pFileEntry' data-ref="54pFileEntry" >pFileEntry</a> = <a class="ref" href="#_Z13FindRootEntryR14_DYNAMIC_ARRAYj" title='FindRootEntry' data-ref="_Z13FindRootEntryR14_DYNAMIC_ARRAYj" >FindRootEntry</a>(<a class="local col2 ref" href="#52pRootHandler" title='pRootHandler' data-ref="52pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::FileTable" title='TRootHandler_WoW6::FileTable' data-use='a' data-ref="TRootHandler_WoW6::FileTable" >FileTable</a>, <a class="local col5 ref" href="#55FileDataId" title='FileDataId' data-ref="55FileDataId" >FileDataId</a>);</td></tr>
<tr><th id="392">392</th><td>    }</td></tr>
<tr><th id="393">393</th><td>    <b>else</b></td></tr>
<tr><th id="394">394</th><td>    {</td></tr>
<tr><th id="395">395</th><td>        <i>// Find by the file name hash</i></td></tr>
<tr><th id="396">396</th><td>        <a class="local col4 ref" href="#54pFileEntry" title='pFileEntry' data-ref="54pFileEntry" >pFileEntry</a> = <a class="ref" href="#_Z13FindRootEntryP9_CASC_MAPPKcPj" title='FindRootEntry' data-ref="_Z13FindRootEntryP9_CASC_MAPPKcPj" >FindRootEntry</a>(<a class="local col2 ref" href="#52pRootHandler" title='pRootHandler' data-ref="52pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::pRootMap" title='TRootHandler_WoW6::pRootMap' data-use='r' data-ref="TRootHandler_WoW6::pRootMap" >pRootMap</a>, <a class="local col3 ref" href="#53szFileName" title='szFileName' data-ref="53szFileName" >szFileName</a>, <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="397">397</th><td>    }</td></tr>
<tr><th id="398">398</th><td></td></tr>
<tr><th id="399">399</th><td>    <b>return</b> (<a class="local col4 ref" href="#54pFileEntry" title='pFileEntry' data-ref="54pFileEntry" >pFileEntry</a> != <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>) ? <a class="local col4 ref" href="#54pFileEntry" title='pFileEntry' data-ref="54pFileEntry" >pFileEntry</a>-&gt;<a class="tu ref" href="#_CASC_FILE_ENTRY::EncodingKey" title='_CASC_FILE_ENTRY::EncodingKey' data-use='m' data-ref="_CASC_FILE_ENTRY::EncodingKey" >EncodingKey</a>.<a class="ref" href="CascCommon.h.html#_ENCODING_KEY::Value" title='_ENCODING_KEY::Value' data-ref="_ENCODING_KEY::Value" id="_ENCODING_KEY::Value" >Value</a> : <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="400">400</th><td>}</td></tr>
<tr><th id="401">401</th><td></td></tr>
<tr><th id="402">402</th><td><em>static</em> <em>void</em> <dfn class="tu decl def" id="_ZL20WowHandler_EndSearchP17TRootHandler_WoW6P12_TCascSearch" title='WowHandler_EndSearch' data-type='void WowHandler_EndSearch(TRootHandler_WoW6 * , TCascSearch * pSearch)' data-ref="_ZL20WowHandler_EndSearchP17TRootHandler_WoW6P12_TCascSearch" >WowHandler_EndSearch</dfn>(<a class="type" href="#TRootHandler_WoW6" title='TRootHandler_WoW6' data-ref="TRootHandler_WoW6" >TRootHandler_WoW6</a> * <i  data-doc="_ZL20WowHandler_EndSearchP17TRootHandler_WoW6P12_TCascSearch">/* pRootHandler */</i>, <a class="typedef" href="CascCommon.h.html#TCascSearch" title='TCascSearch' data-type='struct _TCascSearch' data-ref="TCascSearch" >TCascSearch</a> * <dfn class="local col7 decl" id="57pSearch" title='pSearch' data-type='TCascSearch *' data-ref="57pSearch" >pSearch</dfn>)</td></tr>
<tr><th id="403">403</th><td>{</td></tr>
<tr><th id="404">404</th><td>    <b>if</b>(<a class="local col7 ref" href="#57pSearch" title='pSearch' data-ref="57pSearch" >pSearch</a>-&gt;<a class="ref" href="CascCommon.h.html#_TCascSearch::pRootContext" title='_TCascSearch::pRootContext' data-ref="_TCascSearch::pRootContext" id="_TCascSearch::pRootContext" >pRootContext</a> != <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>)</td></tr>
<tr><th id="405">405</th><td>        <a class="macro" href="CascCommon.h.html#303" title="free(pSearch-&gt;pRootContext)" data-ref="_M/CASC_FREE">CASC_FREE</a>(<a class="local col7 ref" href="#57pSearch" title='pSearch' data-ref="57pSearch" >pSearch</a>-&gt;<a class="ref" href="CascCommon.h.html#_TCascSearch::pRootContext" title='_TCascSearch::pRootContext' data-ref="_TCascSearch::pRootContext" id="_TCascSearch::pRootContext" >pRootContext</a>);</td></tr>
<tr><th id="406">406</th><td>    <a class="local col7 ref" href="#57pSearch" title='pSearch' data-ref="57pSearch" >pSearch</a>-&gt;<a class="ref" href="CascCommon.h.html#_TCascSearch::pRootContext" title='_TCascSearch::pRootContext' data-ref="_TCascSearch::pRootContext" id="_TCascSearch::pRootContext" >pRootContext</a> = <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="407">407</th><td>}</td></tr>
<tr><th id="408">408</th><td></td></tr>
<tr><th id="409">409</th><td><em>static</em> <em>void</em> <dfn class="tu decl def" id="_ZL16WowHandler_CloseP17TRootHandler_WoW6" title='WowHandler_Close' data-type='void WowHandler_Close(TRootHandler_WoW6 * pRootHandler)' data-ref="_ZL16WowHandler_CloseP17TRootHandler_WoW6" >WowHandler_Close</dfn>(<a class="type" href="#TRootHandler_WoW6" title='TRootHandler_WoW6' data-ref="TRootHandler_WoW6" >TRootHandler_WoW6</a> * <dfn class="local col8 decl" id="58pRootHandler" title='pRootHandler' data-type='TRootHandler_WoW6 *' data-ref="58pRootHandler" >pRootHandler</dfn>)</td></tr>
<tr><th id="410">410</th><td>{</td></tr>
<tr><th id="411">411</th><td>    <b>if</b>(<a class="local col8 ref" href="#58pRootHandler" title='pRootHandler' data-ref="58pRootHandler" >pRootHandler</a> != <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>)</td></tr>
<tr><th id="412">412</th><td>    {</td></tr>
<tr><th id="413">413</th><td>        <a class="ref" href="common/DynamicArray.h.html#_Z10Array_FreeP14_DYNAMIC_ARRAY" title='Array_Free' data-ref="_Z10Array_FreeP14_DYNAMIC_ARRAY" id="_Z10Array_FreeP14_DYNAMIC_ARRAY" >Array_Free</a>(&amp;<a class="local col8 ref" href="#58pRootHandler" title='pRootHandler' data-ref="58pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::FileTable" title='TRootHandler_WoW6::FileTable' data-use='a' data-ref="TRootHandler_WoW6::FileTable" >FileTable</a>);</td></tr>
<tr><th id="414">414</th><td>        <a class="ref" href="common/Map.h.html#_Z8Map_FreeP9_CASC_MAP" title='Map_Free' data-ref="_Z8Map_FreeP9_CASC_MAP" id="_Z8Map_FreeP9_CASC_MAP" >Map_Free</a>(<a class="local col8 ref" href="#58pRootHandler" title='pRootHandler' data-ref="58pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::pRootMap" title='TRootHandler_WoW6::pRootMap' data-use='r' data-ref="TRootHandler_WoW6::pRootMap" >pRootMap</a>);</td></tr>
<tr><th id="415">415</th><td>        <a class="macro" href="CascCommon.h.html#303" title="free(pRootHandler)" data-ref="_M/CASC_FREE">CASC_FREE</a>(<a class="local col8 ref" href="#58pRootHandler" title='pRootHandler' data-ref="58pRootHandler" >pRootHandler</a>);</td></tr>
<tr><th id="416">416</th><td>    }</td></tr>
<tr><th id="417">417</th><td>}</td></tr>
<tr><th id="418">418</th><td></td></tr>
<tr><th id="419">419</th><td><u>#<span data-ppcond="419">ifdef</span> <span class="macro" data-ref="_M/_DEBUG">_DEBUG</span></u></td></tr>
<tr><th id="420">420</th><td><em>static</em> <em>void</em> TRootHandlerWoW6_Dump(</td></tr>
<tr><th id="421">421</th><td>    TCascStorage * hs,</td></tr>
<tr><th id="422">422</th><td>    TDumpContext * dc,                                      <i>// Pointer to an opened file</i></td></tr>
<tr><th id="423">423</th><td>    LPBYTE pbRootFile,</td></tr>
<tr><th id="424">424</th><td>    DWORD cbRootFile,</td></tr>
<tr><th id="425">425</th><td>    <em>const</em> TCHAR * szListFile,</td></tr>
<tr><th id="426">426</th><td>    <em>int</em> nDumpLevel)</td></tr>
<tr><th id="427">427</th><td>{</td></tr>
<tr><th id="428">428</th><td>    PCASC_ENCODING_ENTRY pEncodingEntry;</td></tr>
<tr><th id="429">429</th><td>    CASC_ROOT_BLOCK BlockInfo;</td></tr>
<tr><th id="430">430</th><td>    PLISTFILE_MAP pListMap;</td></tr>
<tr><th id="431">431</th><td>    QUERY_KEY EncodingKey;</td></tr>
<tr><th id="432">432</th><td>    LPBYTE pbRootFileEnd = pbRootFile + cbRootFile;</td></tr>
<tr><th id="433">433</th><td>    LPBYTE pbFilePointer;</td></tr>
<tr><th id="434">434</th><td>    <em>char</em> szOneLine[<var>0x100</var>];</td></tr>
<tr><th id="435">435</th><td>    DWORD i;</td></tr>
<tr><th id="436">436</th><td></td></tr>
<tr><th id="437">437</th><td>    <i>// Create the listfile map</i></td></tr>
<tr><th id="438">438</th><td>    pListMap = ListFile_CreateMap(szListFile);</td></tr>
<tr><th id="439">439</th><td></td></tr>
<tr><th id="440">440</th><td>    <i>// Dump the root entries</i></td></tr>
<tr><th id="441">441</th><td>    <b>for</b>(pbFilePointer = pbRootFile; pbFilePointer &lt;= pbRootFileEnd; )</td></tr>
<tr><th id="442">442</th><td>    {</td></tr>
<tr><th id="443">443</th><td>        <i>// Validate the root block</i></td></tr>
<tr><th id="444">444</th><td>        pbFilePointer = VerifyLocaleBlock(&amp;BlockInfo, pbFilePointer, pbRootFileEnd);</td></tr>
<tr><th id="445">445</th><td>        <b>if</b>(pbFilePointer == NULL)</td></tr>
<tr><th id="446">446</th><td>            <b>break</b>;</td></tr>
<tr><th id="447">447</th><td></td></tr>
<tr><th id="448">448</th><td>        <i>// Dump the locale block</i></td></tr>
<tr><th id="449">449</th><td>        dump_print(dc, <q>"Flags: %08X  Locales: %08X  NumberOfFiles: %u\n"</q></td></tr>
<tr><th id="450">450</th><td>                       <q>"=========================================================\n"</q>,</td></tr>
<tr><th id="451">451</th><td>                       BlockInfo.pLocaleBlockHdr-&gt;Flags, </td></tr>
<tr><th id="452">452</th><td>                       BlockInfo.pLocaleBlockHdr-&gt;Locales,</td></tr>
<tr><th id="453">453</th><td>                       BlockInfo.pLocaleBlockHdr-&gt;NumberOfFiles);</td></tr>
<tr><th id="454">454</th><td></td></tr>
<tr><th id="455">455</th><td>        <i>// Dump the hashes and encoding keys</i></td></tr>
<tr><th id="456">456</th><td>        <b>for</b>(i = <var>0</var>; i &lt; BlockInfo.pLocaleBlockHdr-&gt;NumberOfFiles; i++)</td></tr>
<tr><th id="457">457</th><td>        {</td></tr>
<tr><th id="458">458</th><td>            <i>// Dump the entry</i></td></tr>
<tr><th id="459">459</th><td>            dump_print(dc, <q>"%08X %08X-%08X %s %s\n"</q>,</td></tr>
<tr><th id="460">460</th><td>                           (DWORD)(BlockInfo.FileDataIds[i]),</td></tr>
<tr><th id="461">461</th><td>                           (DWORD)(BlockInfo.pRootEntries[i].FileNameHash &gt;&gt; <var>0x20</var>),</td></tr>
<tr><th id="462">462</th><td>                           (DWORD)(BlockInfo.pRootEntries[i].FileNameHash),</td></tr>
<tr><th id="463">463</th><td>                           StringFromMD5(BlockInfo.pRootEntries[i].EncodingKey.Value, szOneLine),</td></tr>
<tr><th id="464">464</th><td>                           ListFile_FindName(pListMap, BlockInfo.pRootEntries[i].FileNameHash));</td></tr>
<tr><th id="465">465</th><td></td></tr>
<tr><th id="466">466</th><td>            <i>// Find the encoding entry in the encoding table</i></td></tr>
<tr><th id="467">467</th><td>            <b>if</b>(nDumpLevel &gt;= DUMP_LEVEL_ENCODING_FILE)</td></tr>
<tr><th id="468">468</th><td>            {</td></tr>
<tr><th id="469">469</th><td>                EncodingKey.pbData = BlockInfo.pRootEntries[i].EncodingKey.Value;</td></tr>
<tr><th id="470">470</th><td>                EncodingKey.cbData = MD5_HASH_SIZE;</td></tr>
<tr><th id="471">471</th><td>                pEncodingEntry = FindEncodingEntry(hs, &amp;EncodingKey, NULL);</td></tr>
<tr><th id="472">472</th><td>                CascDumpEncodingEntry(hs, dc, pEncodingEntry, nDumpLevel);</td></tr>
<tr><th id="473">473</th><td>            }</td></tr>
<tr><th id="474">474</th><td>        }</td></tr>
<tr><th id="475">475</th><td></td></tr>
<tr><th id="476">476</th><td>        <i>// Put extra newline</i></td></tr>
<tr><th id="477">477</th><td>        dump_print(dc, <q>"\n"</q>);</td></tr>
<tr><th id="478">478</th><td>    }</td></tr>
<tr><th id="479">479</th><td>    </td></tr>
<tr><th id="480">480</th><td>    ListFile_FreeMap(pListMap);</td></tr>
<tr><th id="481">481</th><td>}</td></tr>
<tr><th id="482">482</th><td><u>#<span data-ppcond="419">endif</span></u></td></tr>
<tr><th id="483">483</th><td></td></tr>
<tr><th id="484">484</th><td><i>//-----------------------------------------------------------------------------</i></td></tr>
<tr><th id="485">485</th><td><i>// Public functions</i></td></tr>
<tr><th id="486">486</th><td></td></tr>
<tr><th id="487">487</th><td><em>int</em> <dfn class="decl def" id="_Z22RootHandler_CreateWoW6P13_TCascStoragePhjj" title='RootHandler_CreateWoW6' data-ref="_Z22RootHandler_CreateWoW6P13_TCascStoragePhjj" >RootHandler_CreateWoW6</dfn>(<a class="typedef" href="CascCommon.h.html#TCascStorage" title='TCascStorage' data-type='struct _TCascStorage' data-ref="TCascStorage" >TCascStorage</a> * <dfn class="local col9 decl" id="59hs" title='hs' data-type='TCascStorage *' data-ref="59hs" >hs</dfn>, <a class="typedef" href="CascPort.h.html#LPBYTE" title='LPBYTE' data-type='BYTE *' data-ref="LPBYTE" >LPBYTE</a> <dfn class="local col0 decl" id="60pbRootFile" title='pbRootFile' data-type='LPBYTE' data-ref="60pbRootFile" >pbRootFile</dfn>, <a class="typedef" href="CascPort.h.html#DWORD" title='DWORD' data-type='unsigned int' data-ref="DWORD" >DWORD</a> <dfn class="local col1 decl" id="61cbRootFile" title='cbRootFile' data-type='DWORD' data-ref="61cbRootFile" >cbRootFile</dfn>, <a class="typedef" href="CascPort.h.html#DWORD" title='DWORD' data-type='unsigned int' data-ref="DWORD" >DWORD</a> <dfn class="local col2 decl" id="62dwLocaleMask" title='dwLocaleMask' data-type='DWORD' data-ref="62dwLocaleMask" >dwLocaleMask</dfn>)</td></tr>
<tr><th id="488">488</th><td>{</td></tr>
<tr><th id="489">489</th><td>    <a class="type" href="#TRootHandler_WoW6" title='TRootHandler_WoW6' data-ref="TRootHandler_WoW6" >TRootHandler_WoW6</a> * <dfn class="local col3 decl" id="63pRootHandler" title='pRootHandler' data-type='TRootHandler_WoW6 *' data-ref="63pRootHandler" >pRootHandler</dfn>;</td></tr>
<tr><th id="490">490</th><td>    <a class="typedef" href="CascPort.h.html#LPBYTE" title='LPBYTE' data-type='BYTE *' data-ref="LPBYTE" >LPBYTE</a> <dfn class="local col4 decl" id="64pbRootFileEnd" title='pbRootFileEnd' data-type='LPBYTE' data-ref="64pbRootFileEnd" >pbRootFileEnd</dfn> = <a class="local col0 ref" href="#60pbRootFile" title='pbRootFile' data-ref="60pbRootFile" >pbRootFile</a> + <a class="local col1 ref" href="#61cbRootFile" title='cbRootFile' data-ref="61cbRootFile" >cbRootFile</a>;</td></tr>
<tr><th id="491">491</th><td>    <em>int</em> <dfn class="local col5 decl" id="65nError" title='nError' data-type='int' data-ref="65nError" >nError</dfn>;</td></tr>
<tr><th id="492">492</th><td></td></tr>
<tr><th id="493">493</th><td>    <i>// Verify the size</i></td></tr>
<tr><th id="494">494</th><td>    <b>if</b>(<a class="local col0 ref" href="#60pbRootFile" title='pbRootFile' data-ref="60pbRootFile" >pbRootFile</a> == <span class="macro" title="__null" data-ref="_M/NULL">NULL</span> || <a class="local col1 ref" href="#61cbRootFile" title='cbRootFile' data-ref="61cbRootFile" >cbRootFile</a> &lt;= <b>sizeof</b>(<a class="typedef" href="#PFILE_LOCALE_BLOCK" title='PFILE_LOCALE_BLOCK' data-type='struct _FILE_LOCALE_BLOCK *' data-ref="PFILE_LOCALE_BLOCK" >PFILE_LOCALE_BLOCK</a>))</td></tr>
<tr><th id="495">495</th><td>        <a class="local col5 ref" href="#65nError" title='nError' data-ref="65nError" >nError</a> = <a class="macro" href="CascPort.h.html#218" title="1004" data-ref="_M/ERROR_FILE_CORRUPT">ERROR_FILE_CORRUPT</a>;</td></tr>
<tr><th id="496">496</th><td></td></tr>
<tr><th id="497">497</th><td>    <i>// Allocate the root handler object</i></td></tr>
<tr><th id="498">498</th><td>    <a class="local col9 ref" href="#59hs" title='hs' data-ref="59hs" >hs</a>-&gt;<a class="ref" href="CascCommon.h.html#_TCascStorage::pRootHandler" title='_TCascStorage::pRootHandler' data-ref="_TCascStorage::pRootHandler" id="_TCascStorage::pRootHandler" >pRootHandler</a> = <a class="local col3 ref" href="#63pRootHandler" title='pRootHandler' data-ref="63pRootHandler" >pRootHandler</a> = <a class="macro" href="CascCommon.h.html#302" title="(TRootHandler_WoW6 *)malloc((1) * sizeof(TRootHandler_WoW6))" data-ref="_M/CASC_ALLOC">CASC_ALLOC</a>(<a class="type" href="#TRootHandler_WoW6" title='TRootHandler_WoW6' data-ref="TRootHandler_WoW6" ><a class="type" href="#TRootHandler_WoW6" title='TRootHandler_WoW6' data-ref="TRootHandler_WoW6" >TRootHandler_WoW6</a></a>, <var>1</var>);</td></tr>
<tr><th id="499">499</th><td>    <b>if</b>(<a class="local col3 ref" href="#63pRootHandler" title='pRootHandler' data-ref="63pRootHandler" >pRootHandler</a> == <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>)</td></tr>
<tr><th id="500">500</th><td>        <b>return</b> <a class="macro" href="CascPort.h.html#208" title="12" data-ref="_M/ERROR_NOT_ENOUGH_MEMORY">ERROR_NOT_ENOUGH_MEMORY</a>;</td></tr>
<tr><th id="501">501</th><td></td></tr>
<tr><th id="502">502</th><td>    <i>// Fill-in the handler functions</i></td></tr>
<tr><th id="503">503</th><td>    <a class="ref" href="../../../../include/string.h.html#memset" title='memset' data-ref="memset" id="memset" >memset</a>(<a class="local col3 ref" href="#63pRootHandler" title='pRootHandler' data-ref="63pRootHandler" >pRootHandler</a>, <var>0</var>, <b>sizeof</b>(<a class="type" href="#TRootHandler_WoW6" title='TRootHandler_WoW6' data-ref="TRootHandler_WoW6" >TRootHandler_WoW6</a>));</td></tr>
<tr><th id="504">504</th><td>    <a class="local col3 ref" href="#63pRootHandler" title='pRootHandler' data-ref="63pRootHandler" >pRootHandler</a>-&gt;<a class="ref" href="common/RootHandler.h.html#TRootHandler::Insert" title='TRootHandler::Insert' data-ref="TRootHandler::Insert" id="TRootHandler::Insert" >Insert</a>      = (<a class="typedef" href="common/RootHandler.h.html#ROOT_INSERT" title='ROOT_INSERT' data-type='int (*)(struct TRootHandler *, const char *, LPBYTE)' data-ref="ROOT_INSERT" >ROOT_INSERT</a>)<a class="tu ref" href="#_ZL17WowHandler_InsertP17TRootHandler_WoW6PKcPh" title='WowHandler_Insert' data-use='r' data-ref="_ZL17WowHandler_InsertP17TRootHandler_WoW6PKcPh" >WowHandler_Insert</a>;</td></tr>
<tr><th id="505">505</th><td>    <a class="local col3 ref" href="#63pRootHandler" title='pRootHandler' data-ref="63pRootHandler" >pRootHandler</a>-&gt;<a class="ref" href="common/RootHandler.h.html#TRootHandler::Search" title='TRootHandler::Search' data-ref="TRootHandler::Search" id="TRootHandler::Search" >Search</a>      = (<a class="typedef" href="common/RootHandler.h.html#ROOT_SEARCH" title='ROOT_SEARCH' data-type='LPBYTE (*)(struct TRootHandler *, struct _TCascSearch *, PDWORD, PDWORD)' data-ref="ROOT_SEARCH" >ROOT_SEARCH</a>)<a class="tu ref" href="#_ZL17WowHandler_SearchP17TRootHandler_WoW6P12_TCascSearchPjS3_" title='WowHandler_Search' data-use='r' data-ref="_ZL17WowHandler_SearchP17TRootHandler_WoW6P12_TCascSearchPjS3_" >WowHandler_Search</a>;</td></tr>
<tr><th id="506">506</th><td>    <a class="local col3 ref" href="#63pRootHandler" title='pRootHandler' data-ref="63pRootHandler" >pRootHandler</a>-&gt;<a class="ref" href="common/RootHandler.h.html#TRootHandler::EndSearch" title='TRootHandler::EndSearch' data-ref="TRootHandler::EndSearch" id="TRootHandler::EndSearch" >EndSearch</a>   = (<a class="typedef" href="common/RootHandler.h.html#ROOT_ENDSEARCH" title='ROOT_ENDSEARCH' data-type='void (*)(struct TRootHandler *, struct _TCascSearch *)' data-ref="ROOT_ENDSEARCH" >ROOT_ENDSEARCH</a>)<a class="tu ref" href="#_ZL20WowHandler_EndSearchP17TRootHandler_WoW6P12_TCascSearch" title='WowHandler_EndSearch' data-use='r' data-ref="_ZL20WowHandler_EndSearchP17TRootHandler_WoW6P12_TCascSearch" >WowHandler_EndSearch</a>;</td></tr>
<tr><th id="507">507</th><td>    <a class="local col3 ref" href="#63pRootHandler" title='pRootHandler' data-ref="63pRootHandler" >pRootHandler</a>-&gt;<a class="ref" href="common/RootHandler.h.html#TRootHandler::GetKey" title='TRootHandler::GetKey' data-ref="TRootHandler::GetKey" id="TRootHandler::GetKey" >GetKey</a>      = (<a class="typedef" href="common/RootHandler.h.html#ROOT_GETKEY" title='ROOT_GETKEY' data-type='LPBYTE (*)(struct TRootHandler *, const char *)' data-ref="ROOT_GETKEY" >ROOT_GETKEY</a>)<a class="tu ref" href="#_ZL17WowHandler_GetKeyP17TRootHandler_WoW6PKc" title='WowHandler_GetKey' data-use='r' data-ref="_ZL17WowHandler_GetKeyP17TRootHandler_WoW6PKc" >WowHandler_GetKey</a>;</td></tr>
<tr><th id="508">508</th><td>    <a class="local col3 ref" href="#63pRootHandler" title='pRootHandler' data-ref="63pRootHandler" >pRootHandler</a>-&gt;<a class="ref" href="common/RootHandler.h.html#TRootHandler::Close" title='TRootHandler::Close' data-ref="TRootHandler::Close" id="TRootHandler::Close" >Close</a>       = (<a class="typedef" href="common/RootHandler.h.html#ROOT_CLOSE" title='ROOT_CLOSE' data-type='void (*)(struct TRootHandler *)' data-ref="ROOT_CLOSE" >ROOT_CLOSE</a>)<a class="tu ref" href="#_ZL16WowHandler_CloseP17TRootHandler_WoW6" title='WowHandler_Close' data-use='r' data-ref="_ZL16WowHandler_CloseP17TRootHandler_WoW6" >WowHandler_Close</a>;</td></tr>
<tr><th id="509">509</th><td></td></tr>
<tr><th id="510">510</th><td><u>#<span data-ppcond="510">ifdef</span> <span class="macro" data-ref="_M/_DEBUG">_DEBUG</span></u></td></tr>
<tr><th id="511">511</th><td>    pRootHandler-&gt;Dump = TRootHandlerWoW6_Dump;    <i>// Support for ROOT file dump</i></td></tr>
<tr><th id="512">512</th><td><u>#<span data-ppcond="510">endif</span>  // _DEBUG</u></td></tr>
<tr><th id="513">513</th><td></td></tr>
<tr><th id="514">514</th><td>    <i>// Count the files that are going to be loaded</i></td></tr>
<tr><th id="515">515</th><td>    <a class="tu ref" href="#_ZL16ParseWowRootFileP17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_j" title='ParseWowRootFile' data-use='c' data-ref="_ZL16ParseWowRootFileP17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_j" >ParseWowRootFile</a>(<a class="local col3 ref" href="#63pRootHandler" title='pRootHandler' data-ref="63pRootHandler" >pRootHandler</a>, <a class="tu ref" href="#_ZL20ParseRoot_CountFilesP17TRootHandler_WoW6P16_CASC_ROOT_BLOCK" title='ParseRoot_CountFiles' data-use='r' data-ref="_ZL20ParseRoot_CountFilesP17TRootHandler_WoW6P16_CASC_ROOT_BLOCK" >ParseRoot_CountFiles</a>, <a class="local col0 ref" href="#60pbRootFile" title='pbRootFile' data-ref="60pbRootFile" >pbRootFile</a>, <a class="local col4 ref" href="#64pbRootFileEnd" title='pbRootFileEnd' data-ref="64pbRootFileEnd" >pbRootFileEnd</a>, <a class="local col2 ref" href="#62dwLocaleMask" title='dwLocaleMask' data-ref="62dwLocaleMask" >dwLocaleMask</a>);</td></tr>
<tr><th id="516">516</th><td>    <a class="local col3 ref" href="#63pRootHandler" title='pRootHandler' data-ref="63pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::dwTotalFileCount" title='TRootHandler_WoW6::dwTotalFileCount' data-use='w' data-ref="TRootHandler_WoW6::dwTotalFileCount" >dwTotalFileCount</a> += <a class="macro" href="CascCommon.h.html#53" title="0x20" data-ref="_M/CASC_EXTRA_FILES">CASC_EXTRA_FILES</a>;</td></tr>
<tr><th id="517">517</th><td></td></tr>
<tr><th id="518">518</th><td>    <i>// Create linear table that will contain all root items</i></td></tr>
<tr><th id="519">519</th><td>    <a class="local col5 ref" href="#65nError" title='nError' data-ref="65nError" >nError</a> = <a class="macro" href="common/DynamicArray.h.html#35" title="Array_Create_(&amp;pRootHandler-&gt;FileTable, sizeof(CASC_FILE_ENTRY), pRootHandler-&gt;dwTotalFileCount)" data-ref="_M/Array_Create">Array_Create</a>(&amp;<a class="local col3 ref" href="#63pRootHandler" title='pRootHandler' data-ref="63pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::FileTable" title='TRootHandler_WoW6::FileTable' data-use='a' data-ref="TRootHandler_WoW6::FileTable" >FileTable</a>, <a class="typedef" href="#CASC_FILE_ENTRY" title='CASC_FILE_ENTRY' data-type='struct _CASC_FILE_ENTRY' data-ref="CASC_FILE_ENTRY" >CASC_FILE_ENTRY</a>, <a class="local col3 ref" href="#63pRootHandler" title='pRootHandler' data-ref="63pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::dwTotalFileCount" title='TRootHandler_WoW6::dwTotalFileCount' data-use='r' data-ref="TRootHandler_WoW6::dwTotalFileCount" >dwTotalFileCount</a>);</td></tr>
<tr><th id="520">520</th><td>    <b>if</b>(<a class="local col5 ref" href="#65nError" title='nError' data-ref="65nError" >nError</a> != <a class="macro" href="CascPort.h.html#204" title="0" data-ref="_M/ERROR_SUCCESS">ERROR_SUCCESS</a>)</td></tr>
<tr><th id="521">521</th><td>        <b>return</b> <a class="local col5 ref" href="#65nError" title='nError' data-ref="65nError" >nError</a>;</td></tr>
<tr><th id="522">522</th><td></td></tr>
<tr><th id="523">523</th><td>    <i>// Create the map of FileHash -&gt;FileEntry</i></td></tr>
<tr><th id="524">524</th><td>    <a class="local col3 ref" href="#63pRootHandler" title='pRootHandler' data-ref="63pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::pRootMap" title='TRootHandler_WoW6::pRootMap' data-use='w' data-ref="TRootHandler_WoW6::pRootMap" >pRootMap</a> = <a class="ref" href="common/Map.h.html#_Z10Map_Createjjj" title='Map_Create' data-ref="_Z10Map_Createjjj" id="_Z10Map_Createjjj" >Map_Create</a>(<a class="local col3 ref" href="#63pRootHandler" title='pRootHandler' data-ref="63pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::dwTotalFileCount" title='TRootHandler_WoW6::dwTotalFileCount' data-use='r' data-ref="TRootHandler_WoW6::dwTotalFileCount" >dwTotalFileCount</a>, <b>sizeof</b>(<a class="typedef" href="CascPort.h.html#ULONGLONG" title='ULONGLONG' data-type='unsigned long long' data-ref="ULONGLONG" >ULONGLONG</a>), <a class="macro" href="CascPort.h.html#122" title="__builtin_offsetof(CASC_FILE_ENTRY, FileNameHash)" data-ref="_M/FIELD_OFFSET">FIELD_OFFSET</a>(<a class="typedef" href="#CASC_FILE_ENTRY" title='CASC_FILE_ENTRY' data-type='struct _CASC_FILE_ENTRY' data-ref="CASC_FILE_ENTRY" >CASC_FILE_ENTRY</a>, FileNameHash));</td></tr>
<tr><th id="525">525</th><td>    <b>if</b>(<a class="local col3 ref" href="#63pRootHandler" title='pRootHandler' data-ref="63pRootHandler" >pRootHandler</a>-&gt;<a class="tu ref" href="#TRootHandler_WoW6::pRootMap" title='TRootHandler_WoW6::pRootMap' data-use='r' data-ref="TRootHandler_WoW6::pRootMap" >pRootMap</a> == <span class="macro" title="__null" data-ref="_M/NULL">NULL</span>)</td></tr>
<tr><th id="526">526</th><td>        <b>return</b> <a class="macro" href="CascPort.h.html#208" title="12" data-ref="_M/ERROR_NOT_ENOUGH_MEMORY">ERROR_NOT_ENOUGH_MEMORY</a>;</td></tr>
<tr><th id="527">527</th><td></td></tr>
<tr><th id="528">528</th><td>    <i>// Parse the root file again and insert all files to the map</i></td></tr>
<tr><th id="529">529</th><td>    <a class="tu ref" href="#_ZL16ParseWowRootFileP17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_j" title='ParseWowRootFile' data-use='c' data-ref="_ZL16ParseWowRootFileP17TRootHandler_WoW6PFiS0_P16_CASC_ROOT_BLOCKEPhS5_j" >ParseWowRootFile</a>(<a class="local col3 ref" href="#63pRootHandler" title='pRootHandler' data-ref="63pRootHandler" >pRootHandler</a>, <a class="tu ref" href="#_ZL24ParseRoot_AddRootEntriesP17TRootHandler_WoW6P16_CASC_ROOT_BLOCK" title='ParseRoot_AddRootEntries' data-use='r' data-ref="_ZL24ParseRoot_AddRootEntriesP17TRootHandler_WoW6P16_CASC_ROOT_BLOCK" >ParseRoot_AddRootEntries</a>, <a class="local col0 ref" href="#60pbRootFile" title='pbRootFile' data-ref="60pbRootFile" >pbRootFile</a>, <a class="local col4 ref" href="#64pbRootFileEnd" title='pbRootFileEnd' data-ref="64pbRootFileEnd" >pbRootFileEnd</a>, <a class="local col2 ref" href="#62dwLocaleMask" title='dwLocaleMask' data-ref="62dwLocaleMask" >dwLocaleMask</a>);</td></tr>
<tr><th id="530">530</th><td>    <b>return</b> <a class="macro" href="CascPort.h.html#204" title="0" data-ref="_M/ERROR_SUCCESS">ERROR_SUCCESS</a>;</td></tr>
<tr><th id="531">531</th><td>}</td></tr>
<tr><th id="532">532</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2016-Mar-09</em> from project TrinityCore6.x revision <em>6.x</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 1.8
</p>
</div></body></html>
